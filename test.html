<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ å®Œå…¨ç‰ˆ</title>
    <style>
        body { margin: 0; background: #0f172a; color: #e5e7eb; font-family: sans-serif; overflow: hidden; }
        .container { display: flex; height: 90vh; }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ */
        .map-area { flex: 2; position: relative; padding: 20px; background: #1e293b; }
        .header-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .japan-map { position: relative; width: 800px; height: 600px; margin: 0 auto; background: #0f172a; border-radius: 15px; border: 1px solid #334155; }
        
        /* éƒ½é“åºœçœŒãƒ‘ãƒãƒ« */
        .pref { position: absolute; width: 50px; height: 30px; line-height: 30px; text-align: center; font-size: 10px; border-radius: 4px; cursor: pointer; transition: 0.2s; color: white; border: 1px solid #1e293b; }
        .pref.neutral { background: #475569; }
        .pref.you { background: #22c55e; box-shadow: 0 0 10px #22c55e; font-weight: bold; }
        .pref.ai { background: #f97316; box-shadow: 0 0 10px #f97316; }
        .pref:hover { filter: brightness(1.3); z-index: 100; outline: 2px solid yellow; }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .side { flex: 1; background: #111827; padding: 20px; border-left: 2px solid #334155; }
        .turn-indicator { background: #facc15; color: #000; text-align: center; font-weight: bold; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        button { width: 100%; margin: 10px 0; padding: 15px; background: #334155; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #475569; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .status-box { background: #000; padding: 15px; border-radius: 10px; margin-top: 20px; border: 1px solid #10b981; }
        .highlight { font-size: 2rem; color: #22c55e; font-weight: bold; }

        /* è­°å¸­ãƒãƒ¼ */
        .seat-bar-container { height: 10vh; background: #1e293b; padding: 10px 40px; }
        .seat-bar { height: 30px; background: #334155; display: flex; position: relative; border-radius: 15px; overflow: hidden; border: 2px solid #000; }
        .bar { transition: width 0.8s ease; height: 100%; }
        .bar.you { background: #22c55e; }
        .bar.ai { background: #f97316; }
        .bar.neutral { background: #64748b; }
        .majority-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: white; z-index: 10; }
        .majority-label { position: absolute; left: 50%; top: -20px; transform: translateX(-50%); color: white; font-size: 12px; }

        /* çµæœç”»é¢ */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; }
        .modal-content { background:#1e293b; padding:50px; border-radius:20px; text-align:center; border:4px solid #22c55e; }
    </style>
</head>
<body>

<div class="container">
    <div class="map-area">
        <div class="header-info">
            <h2 id="partyDisplay">è‡ªæ°‘å…š vs AIé‡å…š</h2>
            <h3 id="timeDisplay">1æ—¥ç›®ï¼šæœ</h3>
        </div>
        <div id="japan-map" class="japan-map"></div>
    </div>

    <div class="side">
        <h3 id="dayDisplay">æ®‹ã‚Š 15æ—¥</h3>
        <div class="turn-indicator" id="turnInfo">ã‚ãªãŸã®ç•ªã§ã™</div>
        <button id="btnSpeech" onclick="startSpeech()">ğŸ¤ è¡—é ­æ¼”èª¬ (1å›æ¶ˆè²»)</button>
        <button id="btnSNS" onclick="doSNS()">ğŸ“± SNSæ´»å‹• (1å›æ¶ˆè²»)</button>
        <button id="btnSurvey" onclick="doSurvey()">ğŸ“Š æƒ…å‹¢èª¿æŸ» (1å›æ¶ˆè²»)</button>
        <div class="status-box">
            <p>ç²å¾—è­°å¸­ï¼š<span id="seats" class="highlight">0</span> / 465</p>
            <p id="news" style="color: #10b981;">éƒ½é“åºœçœŒã‚’é¸ã‚“ã§æ¼”èª¬ã—ã¦ãã ã•ã„</p>
        </div>
    </div>
</div>

<div class="seat-bar-container">
    <div style="position:relative;">
        <div class="majority-label">éåŠæ•° 233</div>
        <div class="seat-bar">
            <div id="barYou" class="bar you" style="width: 0%"></div>
            <div id="barNeutral" class="bar neutral" style="width: 100%"></div>
            <div id="barAI" class="bar ai" style="width: 0%"></div>
            <div class="majority-line"></div>
        </div>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h1 id="resultTitle"></h1>
        <h2 id="finalSeats"></h2>
        <p id="resultText"></p>
        <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
    </div>
</div>

<script>
// --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 580, y: 50, seats: 17, type: "rural" }, "é’æ£®": { x: 550, y: 150, seats: 6, type: "rural" },
    "å²©æ‰‹": { x: 570, y: 190, seats: 6, type: "rural" }, "å®®åŸ": { x: 560, y: 230, seats: 10, type: "rural" },
    "ç§‹ç”°": { x: 520, y: 190, seats: 5, type: "rural" }, "å±±å½¢": { x: 520, y: 230, seats: 6, type: "rural" },
    "ç¦å³¶": { x: 540, y: 270, seats: 9, type: "rural" }, "èŒ¨åŸ": { x: 540, y: 320, seats: 13, type: "rural" },
    "æ ƒæœ¨": { x: 510, y: 300, seats: 10, type: "rural" }, "ç¾¤é¦¬": { x: 480, y: 300, seats: 10, type: "rural" },
    "åŸ¼ç‰": { x: 490, y: 330, seats: 28, type: "urban" }, "åƒè‘‰": { x: 540, y: 360, seats: 22, type: "urban" },
    "æ±äº¬": { x: 490, y: 370, seats: 30, type: "urban" }, "ç¥å¥ˆå·": { x: 470, y: 400, seats: 26, type: "urban" },
    "æ–°æ½Ÿ": { x: 460, y: 240, seats: 10, type: "rural" }, "å¯Œå±±": { x: 410, y: 250, seats: 6, type: "rural" },
    "çŸ³å·": { x: 370, y: 240, seats: 6, type: "rural" }, "ç¦äº•": { x: 350, y: 280, seats: 4, type: "rural" },
    "å±±æ¢¨": { x: 450, y: 340, seats: 4, type: "rural" }, "é•·é‡": { x: 430, y: 300, seats: 10, type: "rural" },
    "å²é˜œ": { x: 400, y: 330, seats: 10, type: "rural" }, "é™å²¡": { x: 430, y: 380, seats: 16, type: "urban" },
    "æ„›çŸ¥": { x: 390, y: 380, seats: 15, type: "industry" }, "ä¸‰é‡": { x: 360, y: 400, seats: 8, type: "rural" },
    "æ»‹è³€": { x: 360, y: 340, seats: 4, type: "rural" }, "äº¬éƒ½": { x: 330, y: 330, seats: 12, type: "urban" },
    "å¤§é˜ª": { x: 330, y: 370, seats: 19, type: "urban" }, "å…µåº«": { x: 290, y: 330, seats: 12, type: "urban" },
    "å¥ˆè‰¯": { x: 330, y: 410, seats: 6, type: "rural" }, "å’Œæ­Œå±±": { x: 310, y: 440, seats: 5, type: "rural" },
    "é³¥å–": { x: 250, y: 310, seats: 4, type: "rural" }, "å³¶æ ¹": { x: 210, y: 320, seats: 4, type: "rural" },
    "å²¡å±±": { x: 250, y: 350, seats: 10, type: "rural" }, "åºƒå³¶": { x: 210, y: 360, seats: 12, type: "industry" },
    "å±±å£": { x: 170, y: 370, seats: 8, type: "rural" }, "å¾³å³¶": { x: 260, y: 420, seats: 6, type: "rural" },
    "é¦™å·": { x: 230, y: 400, seats: 6, type: "rural" }, "æ„›åª›": { x: 190, y: 410, seats: 8, type: "rural" },
    "é«˜çŸ¥": { x: 210, y: 440, seats: 4, type: "rural" }, "ç¦å²¡": { x: 120, y: 380, seats: 11, type: "urban" },
    "ä½è³€": { x: 90, y: 390, seats: 4, type: "rural" }, "é•·å´": { x: 70, y: 410, seats: 8, type: "rural" },
    "ç†Šæœ¬": { x: 100, y: 430, seats: 8, type: "rural" }, "å¤§åˆ†": { x: 140, y: 420, seats: 6, type: "rural" },
    "å®®å´": { x: 130, y: 470, seats: 6, type: "rural" }, "é¹¿å…å³¶": { x: 100, y: 490, seats: 9, type: "rural" },
    "æ²–ç¸„": { x: 50, y: 550, seats: 4, type: "rural" }
};

// --- ã‚²ãƒ¼ãƒ é€²è¡Œå¤‰æ•° ---
let day = 1;
let turnStep = 0; // 0:æœ, 1:æ˜¼, 2:å¤œ
const STEPS = ["æœ", "æ˜¼", "å¤œ"];
const TOTAL_DAYS = 15;
const status = {};
let currentAction = "speech"; // æœ€åˆã¯æ¼”èª¬ãƒ¢ãƒ¼ãƒ‰

// --- åˆæœŸåŒ– ---
function init() {
    const map = document.getElementById("japan-map");
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.textContent = p;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => clickPref(p);
        map.appendChild(d);
    });
    updateUI();
}

// --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
function startSpeech() {
    currentAction = "speech";
    document.getElementById("news").textContent = "æ¼”èª¬ã™ã‚‹çœŒã‚’åœ°å›³ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„";
}

function clickPref(p) {
    if (currentAction === "speech") {
        status[p] = "you";
        document.getElementById("news").textContent = `${p}ã§æ”¯æŒã‚’è¨´ãˆã¾ã—ãŸï¼`;
        nextStep();
    }
}

function doSNS() {
    let count = 0;
    Object.keys(PREF_DATA).forEach(p => {
        if (PREF_DATA[p].type === "urban" && status[p] === "neutral" && Math.random() > 0.6) {
            status[p] = "you";
            count++;
        }
    });
    document.getElementById("news").textContent = `SNSã§${count}ä»¶ã®éƒ½å¸‚éƒ¨åœ°åŸŸãŒåå¿œï¼`;
    nextStep();
}

function doSurvey() {
    const you = calculateSeats("you");
    document.getElementById("news").textContent = `ã€æƒ…å‹¢ã€‘ç¾åœ¨${you}è­°å¸­ã€‚éåŠæ•°ã¯233ã§ã™ã€‚`;
    nextStep();
}

// --- ãƒ­ã‚¸ãƒƒã‚¯ ---
function nextStep() {
    currentAction = null;
    turnStep++;
    if (turnStep > 2) {
        aiTurn();
        turnStep = 0;
        day++;
    }
    if (day > TOTAL_DAYS) {
        showResult();
    } else {
        updateUI();
    }
}

function aiTurn() {
    // AIãŒ1æ—¥ã«2ã€œ3ç®‡æ‰€ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å–ã‚‹
    for(let i=0; i<3; i++) {
        const targets = Object.keys(status).filter(k => status[k] === "neutral");
        if (targets.length > 0) {
            const t = targets[Math.floor(Math.random() * targets.length)];
            status[t] = "ai";
        }
    }
}

function calculateSeats(owner) {
    return Object.keys(status).reduce((sum, p) => status[p] === owner ? sum + PREF_DATA[p].seats : sum, 0);
}

function updateUI() {
    const you = calculateSeats("you");
    const ai = calculateSeats("ai");
    const neu = 465 - you - ai;

    document.getElementById("seats").textContent = you;
    document.getElementById("dayDisplay").textContent = `æ®‹ã‚Š ${TOTAL_DAYS - day + 1}æ—¥`;
    document.getElementById("timeDisplay").textContent = `${day}æ—¥ç›®ï¼š${STEPS[turnStep]}`;
    
    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barAI").style.width = (ai / 465 * 100) + "%";
    document.getElementById("barNeutral").style.width = (neu / 465 * 100) + "%";

    Object.keys(status).forEach(p => {
        document.getElementById(`pref-${p}`).className = `pref ${status[p]}`;
    });
}

function showResult() {
    const you = calculateSeats("you");
    document.getElementById("resultModal").style.display = "flex";
    document.getElementById("finalSeats").textContent = `${you} è­°å¸­ç²å¾—`;
    if (you >= 233) {
        document.getElementById("resultTitle").textContent = "âœ¨ é¸æŒ™ã«å‹åˆ©ï¼æ”¿æ¨©äº¤ä»£ âœ¨";
        document.getElementById("resultText").textContent = "ã‚ãªãŸã¯æ—¥æœ¬ã‚’å¤‰ãˆã‚‹ãƒªãƒ¼ãƒ€ãƒ¼ã«ãªã‚Šã¾ã—ãŸã€‚";
    } else {
        document.getElementById("resultTitle").textContent = "â— é¸æŒ™ã«æ•—åŒ— â—";
        document.getElementById("resultText").textContent = "éåŠæ•°ã«å±Šã‹ãšã€‚é‡å…šã¨ã—ã¦å‡ºç›´ã—ã¾ã—ã‚‡ã†ã€‚";
    }
}

window.onload = init;
</script>
</body>
</html>
