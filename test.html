<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡†é™¢é¸æ±ºæˆ¦2026 - ç©¶æ¥µå¯¾æˆ¦ç‰ˆ</title>
    <style>
        :root { --you: #00ff41; --ai: #ff4500; --neu: #2d3748; }
        body { margin: 0; background: #020617; color: #f8fafc; font-family: 'Hiragino Sans', 'Meiryo', sans-serif; overflow: hidden; }
        
        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: flex; height: 85vh; width: 100vw; }
        .map-area { flex: 3; position: relative; background: #0f172a; overflow: auto; border: 2px solid #1e293b; }
        .side { flex: 1; background: #1e293b; padding: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: -5px 0 15px rgba(0,0,0,0.5); }
        
        /* å·¨å¤§åŒ–ã—ãŸåœ°å›³ãƒãƒƒãƒ— */
        .japan-map { position: relative; width: 1000px; height: 800px; margin: 20px; background: #020617; border-radius: 20px; }
        .pref { 
            position: absolute; width: 85px; height: 55px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-radius: 8px; cursor: pointer; transition: all 0.3s; color: white; 
            border: 2px solid rgba(255,255,255,0.1); font-weight: bold;
        }
        .pref b { font-size: 14px; margin-bottom: 2px; }
        .pref span { font-size: 12px; color: #cbd5e1; }
        .pref.neutral { background: var(--neu); }
        .pref.you { background: var(--you); color: #000; box-shadow: 0 0 20px var(--you); border-color: #fff; z-index: 50; }
        .pref.ai { background: var(--ai); color: #fff; box-shadow: 0 0 20px var(--ai); border-color: #fff; z-index: 50; }
        .pref:hover { transform: scale(1.2); z-index: 100; border-color: yellow; }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ã‚¿ãƒ¼ãƒ³ */
        .turn-display { 
            background: #fbbf24; color: #000; padding: 15px; text-align: center; 
            border-radius: 12px; font-weight: 900; font-size: 1.5rem; border: 4px solid #000;
        }
        .news-box { 
            background: #000; padding: 15px; border-radius: 10px; flex-grow: 1; 
            border: 2px solid #3b82f6; overflow-y: auto; font-family: 'Courier New', monospace; 
            color: #10b981; font-size: 0.95rem; line-height: 1.4;
        }
        .breaking { color: #ff0000; font-weight: bold; text-decoration: underline; animation: flash 0.8s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* ãƒœã‚¿ãƒ³ */
        .actions button { 
            width: 100%; padding: 15px; background: #334155; color: white; 
            border: 1px solid #475569; border-radius: 10px; cursor: pointer; 
            text-align: left; font-size: 1rem; font-weight: bold; transition: 0.2s;
        }
        .actions button:hover:not(:disabled) { background: #475569; transform: translateX(5px); border-color: #3b82f6; }
        .actions button:disabled { opacity: 0.2; cursor: not-allowed; }

        /* è­°å¸­ãƒãƒ¼ */
        .seat-bar-container { height: 15vh; background: #020617; padding: 10px 60px; }
        .seat-bar { height: 50px; background: #1e293b; display: flex; position: relative; border-radius: 25px; overflow: hidden; border: 4px solid #334155; }
        .bar { transition: width 0.7s ease-in-out; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem; }
        .bar.you { background: var(--you); color: #000; }
        .bar.ai { background: var(--ai); color: #fff; }
        .majority-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #fff; z-index: 30; }
        
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:9999; }
        .modal-content { background:#1e293b; padding:50px; border-radius:30px; text-align:center; border:6px solid var(--you); }
    </style>
</head>
<body>

<div class="container">
    <div class="map-area">
        <div id="japan-map" class="japan-map">
            </div>
    </div>

    <div class="side">
        <div id="timeInfo" style="text-align:center; font-size:1.2rem; font-weight:bold; color:#fbbf24;">1æ—¥ç›®ï¼šæœ</div>
        <div class="turn-display" id="turnIndicator">ã‚ãªãŸã®ç•ª</div>
        
        <div class="actions" id="actionPanel">
            <button onclick="setMode('speech')">ğŸ¤ è¡—é ­æ¼”èª¬ (æŒ‡å®šã—ãŸçœŒã‚’ç¢ºå®Ÿç²å¾—)</button>
            <button onclick="doSNS()">ğŸ“± SNSæˆ¦ç•¥ (éƒ½å¸‚éƒ¨ã®ã©ã“ã‹ã‚’ç²å¾—)</button>
            <button onclick="doSurvey()">ğŸ“Š æƒ…å‹¢èª¿æŸ» (ç²å¾—è­°å¸­ã‚’ãƒã‚§ãƒƒã‚¯)</button>
        </div>

        <div class="news-box" id="newsFeed">
            <div>ã€é€Ÿå ±ã€‘ç¬¬51å›è¡†è­°é™¢è­°å“¡ç·é¸æŒ™ã€å…¬ç¤ºã€‚</div>
        </div>
    </div>
</div>

<div class="seat-bar-container">
    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
        <span>ã‚ãªãŸã®æ”¿å…š</span>
        <span>éåŠæ•°ãƒ©ã‚¤ãƒ³(233)</span>
        <span>ç›¸æ‰‹ã®æ”¿å…š</span>
    </div>
    <div class="seat-bar">
        <div id="barYou" class="bar you" style="width: 0%">0</div>
        <div id="barNeutral" class="bar neutral" style="flex-grow: 1; background: #475569;"></div>
        <div id="barAI" class="bar ai" style="width: 0%">0</div>
        <div class="majority-line"></div>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h1 id="resultTitle">çµæœç™ºè¡¨</h1>
        <h2 id="finalSeats" style="font-size:3rem;"></h2>
        <p id="resultText" style="font-size:1.5rem;"></p>
        <button onclick="location.reload()" style="background:var(--you); color:#000; padding:20px 40px; font-size:1.5rem; border:none; border-radius:15px; margin-top:20px;">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>
</div>

<script>
// åœ°å›³ãƒ‡ãƒ¼ã‚¿ã‚’æ¥µé™ã¾ã§ãƒãƒ©ãƒãƒ©ã«é…ç½®ï¼ˆé‡ãªã‚Šé˜²æ­¢ï¼‰
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 800, y: 30, s: 17, t: "rural" }, "é’æ£®": { x: 800, y: 130, s: 6, t: "rural" },
    "ç§‹ç”°": { x: 700, y: 170, s: 5, t: "rural" }, "å²©æ‰‹": { x: 880, y: 200, s: 6, t: "rural" },
    "å±±å½¢": { x: 720, y: 250, s: 6, t: "rural" }, "å®®åŸ": { x: 860, y: 280, s: 10, t: "rural" },
    "ç¦å³¶": { x: 780, y: 340, s: 9, t: "rural" }, "æ–°æ½Ÿ": { x: 620, y: 230, s: 10, t: "rural" },
    "å¯Œå±±": { x: 500, y: 230, s: 6, t: "rural" }, "çŸ³å·": { x: 400, y: 210, s: 6, t: "rural" },
    "ç¦äº•": { x: 340, y: 280, s: 4, t: "rural" }, "é•·é‡": { x: 540, y: 330, s: 10, t: "rural" },
    "ç¾¤é¦¬": { x: 650, y: 370, s: 10, t: "rural" }, "æ ƒæœ¨": { x: 740, y: 410, s: 10, t: "rural" },
    "èŒ¨åŸ": { x: 850, y: 440, s: 13, t: "rural" }, "åŸ¼ç‰": { x: 660, y: 470, s: 28, t: "urban" },
    "æ±äº¬": { x: 700, y: 560, s: 30, t: "urban" }, "åƒè‘‰": { x: 820, y: 550, s: 22, t: "urban" },
    "ç¥å¥ˆå·": { x: 580, y: 580, s: 26, t: "urban" }, "å±±æ¢¨": { x: 500, y: 450, s: 4, t: "rural" },
    "é™å²¡": { x: 480, y: 550, s: 16, t: "urban" }, "æ„›çŸ¥": { x: 410, y: 480, s: 15, t: "industry" },
    "å²é˜œ": { x: 420, y: 380, s: 10, t: "rural" }, "æ»‹è³€": { x: 350, y: 400, s: 4, t: "rural" },
    "äº¬éƒ½": { x: 300, y: 350, s: 12, t: "urban" }, "å¤§é˜ª": { x: 250, y: 430, s: 19, t: "urban" },
    "å…µåº«": { x: 210, y: 330, s: 12, t: "urban" }, "å¥ˆè‰¯": { x: 320, y: 510, s: 6, t: "rural" },
    "å’Œæ­Œå±±": { x: 260, y: 560, s: 5, t: "rural" }, "ä¸‰é‡": { x: 380, y: 580, s: 8, t: "rural" },
    "é³¥å–": { x: 130, y: 280, s: 4, t: "rural" }, "å³¶æ ¹": { x: 30, y: 280, s: 4, t: "rural" },
    "å²¡å±±": { x: 130, y: 380, s: 10, t: "rural" }, "åºƒå³¶": { x: 40, y: 380, s: 12, t: "industry" },
    "å±±å£": { x: 30, y: 480, s: 8, t: "rural" }, "é¦™å·": { x: 130, y: 520, s: 6, t: "rural" },
    "å¾³å³¶": { x: 210, y: 620, s: 6, t: "rural" }, "æ„›åª›": { x: 30, y: 580, s: 8, t: "rural" },
    "é«˜çŸ¥": { x: 130, y: 620, s: 4, t: "rural" }, "ç¦å²¡": { x: 130, y: 180, s: 11, t: "urban" },
    "ä½è³€": { x: 30, y: 150, s: 4, t: "rural" }, "é•·å´": { x: 30, y: 230, s: 8, t: "rural" },
    "å¤§åˆ†": { x: 220, y: 200, s: 6, t: "rural" }, "ç†Šæœ¬": { x: 100, y: 250, s: 8, t: "rural" },
    "å®®å´": { x: 220, y: 120, s: 6, t: "rural" }, "é¹¿å…å³¶": { x: 100, y: 50, s: 9, t: "rural" },
    "æ²–ç¸„": { x: 20, y: 50, s: 4, t: "rural" }
};

let day = 1;
let turnStep = 0; // æœ, æ˜¼, å¤œ
let isPlayerTurn = true;
let actionLeft = 45;
const status = {};
let currentMode = null;

function init() {
    const map = document.getElementById("japan-map");
    map.innerHTML = "";
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.innerHTML = `<b>${p}</b><span>${PREF_DATA[p].s}è­°å¸­</span>`;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => handlePrefClick(p);
        map.appendChild(d);
    });
    updateUI();
}

function log(msg, important = false) {
    const box = document.getElementById("newsFeed");
    const div = document.createElement("div");
    if (important) div.className = "breaking";
    div.innerHTML = `> ${msg}`;
    box.prepend(div);
}

function setMode(m) {
    if(!isPlayerTurn) return;
    currentMode = m;
    log(`${m === 'speech' ? 'æ¼”èª¬ã™ã‚‹çœŒã‚’åœ°å›³ã§é¸ã‚“ã§ãã ã•ã„' : 'è¡Œå‹•ã‚’é¸æŠä¸­...'}`);
}

function handlePrefClick(p) {
    if (!isPlayerTurn || currentMode !== "speech") return;
    if (status[p] === "you") { log("æ—¢ã«ç²å¾—æ¸ˆã¿ã®çœŒã§ã™"); return; }
    
    status[p] = "you";
    log(`${p}ã§æ¼”èª¬ã‚’è¡Œã„ã€æ”¯æŒã‚’å›ºã‚ã¾ã—ãŸï¼`);
    endPlayerTurn();
}

function doSNS() {
    if (!isPlayerTurn) return;
    const targets = Object.keys(PREF_DATA).filter(p => PREF_DATA[p].t === "urban" && status[p] !== "you");
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`SNSæˆ¦ç•¥ãŒçš„ä¸­ï¼${p}ã®ç„¡å…šæ´¾å±¤ã‚’å–ã‚Šè¾¼ã¿ã¾ã—ãŸã€‚`);
    } else {
        log("SNSã®åå¿œã¯éˆã„ã‚ˆã†ã§ã™ã€‚");
    }
    endPlayerTurn();
}

function doSurvey() {
    if (!isPlayerTurn) return;
    const s = calculate("you");
    log(`ã€æƒ…å‹¢èª¿æŸ»ã€‘ç¾åœ¨ ${s} è­°å¸­ã€‚ç›®æ¨™ã¾ã§ã‚ã¨ ${Math.max(0, 233-s)} ã§ã™ã€‚`);
    endPlayerTurn();
}

function endPlayerTurn() {
    isPlayerTurn = false;
    currentMode = null;
    actionLeft--;
    updateUI();
    
    const indicator = document.getElementById("turnIndicator");
    indicator.textContent = "ç›¸æ‰‹ã®ç•ª (æ€è€ƒä¸­...)";
    indicator.style.background = "#ff4500";
    indicator.style.color = "#fff";

    setTimeout(aiTurn, 1200); // 1.2ç§’å¾Œã«AIãŒå‹•ã
}

function aiTurn() {
    const neutrals = Object.keys(status).filter(p => status[p] !== "ai");
    if (neutrals.length > 0) {
        const p = neutrals[Math.floor(Math.random() * neutrals.length)];
        status[p] = "ai";
        log(`ç›¸æ‰‹å€™è£œãŒ${p}ã§é›†ä¼šã‚’é–‹å‚¬ã€‚æ”¯æŒãŒé€†è»¢ã—ã¾ã—ãŸï¼`);
    }

    turnStep++;
    if (turnStep > 2) {
        turnStep = 0;
        day++;
        // 3æ—¥ã”ã¨ã«å¿…ãšãƒ‹ãƒ¥ãƒ¼ã‚¹ç™ºç”Ÿ
        if (day % 3 === 0) triggerScandal();
    }

    if (actionLeft <= 0) {
        showFinalResult();
    } else {
        isPlayerTurn = true;
        const indicator = document.getElementById("turnIndicator");
        indicator.textContent = "ã‚ãªãŸã®ç•ª";
        indicator.style.background = "#fbbf24";
        indicator.style.color = "#000";
        updateUI();
    }
}

function triggerScandal() {
    const side = Math.random() > 0.5 ? "you" : "ai";
    const targets = Object.keys(status).filter(p => status[p] === side);
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = (side === "you") ? "ai" : "you";
        const party = (side === "you") ? "ã‚ãªãŸã®å…š" : "ç›¸æ‰‹ã®å…š";
        log(`ã€é€Ÿå ±ã€‘${party}ã®å¹¹éƒ¨ã«ä¸ç¥¥äº‹ï¼${p}ã®æ”¯æŒãŒæ€¥è½ã—ã¾ã—ãŸï¼`, true);
    }
}

function calculate(owner) {
    return Object.keys(status).reduce((sum, p) => status[p] === owner ? sum + PREF_DATA[p].s : sum, 0);
}

function updateUI() {
    const you = calculate("you");
    const ai = calculate("ai");
    const steps = ["æœ", "æ˜¼", "å¤œ"];

    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barYou").textContent = you + " è­°å¸­";
    document.getElementById("barAI").style.width = (ai / 465 * 100) + "%";
    document.getElementById("barAI").textContent = ai + " è­°å¸­";
    
    document.getElementById("timeInfo").textContent = `${day}æ—¥ç›®ï¼š${steps[turnStep]} (æ®‹ã‚Š${actionLeft}å›)`;

    Object.keys(status).forEach(p => {
        const el = document.getElementById(`pref-${p}`);
        el.className = `pref ${status[p]}`;
    });

    const btns = document.getElementById("actionPanel").getElementsByTagName("button");
    for(let b of btns) b.disabled = !isPlayerTurn;
}

function showFinalResult() {
    // æœ€çµ‚çš„ã«ä¸­ç«‹ã‚’ãªãã™
    Object.keys(status).forEach(p => {
        if (status[p] === "neutral") status[p] = Math.random() > 0.5 ? "you" : "ai";
    });
    updateUI();

    const you = calculate("you");
    const modal = document.getElementById("resultModal");
    modal.style.display = "flex";
    document.getElementById("finalSeats").textContent = you + " è­°å¸­";
    
    if (you >= 233) {
        document.getElementById("resultTitle").textContent = "âœ¨ è¡†é™¢é¸ å‹åˆ©ï¼ âœ¨";
        document.getElementById("resultText").textContent = "å˜ç‹¬éåŠæ•°ã‚’é”æˆã—ã€å†…é–£ç·ç†å¤§è‡£ã«æŒ‡åã•ã‚Œã¾ã—ãŸï¼";
    } else {
        document.getElementById("resultTitle").textContent = "ğŸŒ‘ é¸æŒ™ æ•—åŒ— ğŸŒ‘";
        document.getElementById("resultText").textContent = "éåŠæ•°ã«å±Šã‹ãšã€‚é‡å…šã¨ã—ã¦å†èµ·ã‚’èª“ã„ã¾ã™ã€‚";
    }
}

window.onload = init;
</script>
</body>
</html>
