<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ ãƒ—ãƒ­ç‰ˆ</title>
    <style>
        :root { --you: #22c55e; --ai: #f97316; --neu: #475569; }
        body { margin: 0; background: #0f172a; color: #e5e7eb; font-family: 'Meiryo', sans-serif; overflow: hidden; }
        .container { display: flex; height: 85vh; }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ */
        .map-area { flex: 2; position: relative; padding: 15px; background: #1e293b; overflow: auto; }
        .header-info { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #0f172a; border-radius: 8px; margin-bottom: 5px; }
        .japan-map { position: relative; width: 850px; height: 650px; margin: 0 auto; background: #0f172a; border-radius: 15px; }
        
        /* éƒ½é“åºœçœŒãƒ‘ãƒãƒ« */
        .pref { position: absolute; width: 60px; height: 35px; line-height: 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; border-radius: 4px; cursor: pointer; transition: 0.2s; color: white; border: 1px solid rgba(255,255,255,0.1); }
        .pref span { font-size: 11px; font-weight: bold; }
        .pref.neutral { background: var(--neu); }
        .pref.you { background: var(--you); box-shadow: 0 0 12px var(--you); font-weight: bold; }
        .pref.ai { background: var(--ai); box-shadow: 0 0 12px var(--ai); }
        .pref:hover { filter: brightness(1.3); z-index: 100; transform: scale(1.1); }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .side { flex: 0.8; background: #111827; padding: 15px; border-left: 2px solid #334155; display: flex; flex-direction: column; }
        .turn-indicator { background: #facc15; color: #000; text-align: center; font-weight: bold; padding: 8px; border-radius: 5px; margin-bottom: 10px; }
        .actions { display: grid; grid-template-columns: 1fr; gap: 8px; }
        button { padding: 10px; background: #334155; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; text-align: left; }
        button:hover:not(:disabled) { background: #475569; }
        button:disabled { opacity: 0.3; }
        .news-box { background: #000; padding: 10px; border-radius: 8px; margin-top: 10px; flex-grow: 1; border: 1px solid #3b82f6; overflow-y: auto; font-size: 0.85rem; }

        /* è­°å¸­ãƒãƒ¼ */
        .seat-bar-container { height: 15vh; background: #1e293b; padding: 10px 50px; border-top: 2px solid #334155; }
        .seat-bar { height: 40px; background: #334155; display: flex; position: relative; border-radius: 20px; overflow: hidden; }
        .bar { transition: width 0.6s ease; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; }
        .bar.you { background: var(--you); }
        .bar.ai { background: var(--ai); }
        .bar.neutral { background: var(--neu); }
        .majority-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: white; z-index: 10; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; }
        .modal-content { background:#1e293b; padding:40px; border-radius:20px; text-align:center; border:4px solid var(--you); max-width: 500px; }
    </style>
</head>
<body>

<div class="container">
    <div class="map-area">
        <div class="header-info">
            <h2 id="partyDisplay">å…šé¦–ï¼šã‚ãªãŸ</h2>
            <h3 id="timeDisplay">1æ—¥ç›®ï¼šæœ</h3>
        </div>
        <div id="japan-map" class="japan-map"></div>
    </div>

    <div class="side">
        <div class="turn-indicator" id="turnInfo">æ®‹ã‚Š 45 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
        <div class="actions">
            <button onclick="setAction('speech')">ğŸ¤ è¡—é ­æ¼”èª¬ï¼šé¸ã‚“ã çœŒã‚’ç¢ºå®Ÿã«ç²å¾—</button>
            <button onclick="doSNS()">ğŸ“± SNSæ´»å‹•ï¼šéƒ½å¸‚éƒ¨ã®æ”¯æŒã‚’å¾®å¢—ã•ã›ã‚‹</button>
            <button onclick="doHome()">ğŸ  æˆ¸åˆ¥è¨ªå•ï¼šåœ°æ–¹1çœŒã‚’ç¢ºå®Ÿã«ç²å¾—</button>
            <button onclick="doTV()">ğŸ“º ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ï¼šå…¨å›½ã®ä¸­ç«‹å±¤ã‚’å‹•ã‹ã™</button>
            <button onclick="doSurvey()">ğŸ“Š æƒ…å‹¢èª¿æŸ»ï¼šæœ€æ–°ã®è­°å¸­äºˆæ¸¬ã‚’ç¢ºèª</button>
        </div>
        <div class="news-box" id="news">ã€é€Ÿå ±ã€‘é¸æŒ™æˆ¦ãŒå…¬ç¤ºã•ã‚Œã¾ã—ãŸã€‚</div>
    </div>
</div>

<div class="seat-bar-container">
    <div style="text-align:center; margin-bottom:5px; font-weight:bold;">è­°å¸­äºˆæ¸¬ï¼ˆéåŠæ•°ï¼š233ï¼‰</div>
    <div class="seat-bar">
        <div id="barYou" class="bar you" style="width: 0%">0</div>
        <div id="barNeutral" class="bar neutral" style="width: 100%">465</div>
        <div id="barAI" class="bar ai" style="width: 0%">0</div>
        <div class="majority-line"></div>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h1 id="resultTitle"></h1>
        <h2 id="finalSeats"></h2>
        <p id="resultText"></p>
        <button onclick="location.reload()" style="text-align:center; background:var(--you);">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
    </div>
</div>

<script>
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 620, y: 40, s: 17, t: "rural" }, "é’æ£®": { x: 620, y: 140, s: 6, t: "rural" },
    "å²©æ‰‹": { x: 650, y: 190, s: 6, t: "rural" }, "ç§‹ç”°": { x: 590, y: 190, s: 5, t: "rural" },
    "å±±å½¢": { x: 590, y: 240, s: 6, t: "rural" }, "å®®åŸ": { x: 650, y: 240, s: 10, t: "rural" },
    "ç¦å³¶": { x: 610, y: 290, s: 9, t: "rural" }, "æ–°æ½Ÿ": { x: 530, y: 250, s: 10, t: "rural" },
    "èŒ¨åŸ": { x: 620, y: 350, s: 13, t: "rural" }, "æ ƒæœ¨": { x: 580, y: 330, s: 10, t: "rural" },
    "ç¾¤é¦¬": { x: 530, y: 310, s: 10, t: "rural" }, "åŸ¼ç‰": { x: 550, y: 370, s: 28, t: "urban" },
    "åƒè‘‰": { x: 610, y: 420, s: 22, t: "urban" }, "æ±äº¬": { x: 550, y: 420, s: 30, t: "urban" },
    "ç¥å¥ˆå·": { x: 520, y: 460, s: 26, t: "urban" }, "å±±æ¢¨": { x: 480, y: 410, s: 4, t: "rural" },
    "é•·é‡": { x: 480, y: 340, s: 10, t: "rural" }, "å¯Œå±±": { x: 450, y: 270, s: 6, t: "rural" },
    "çŸ³å·": { x: 400, y: 260, s: 6, t: "rural" }, "ç¦äº•": { x: 380, y: 310, s: 4, t: "rural" },
    "å²é˜œ": { x: 420, y: 370, s: 10, t: "rural" }, "é™å²¡": { x: 450, y: 460, s: 16, t: "urban" },
    "æ„›çŸ¥": { x: 400, y: 430, s: 15, t: "industry" }, "æ»‹è³€": { x: 370, y: 370, s: 4, t: "rural" },
    "ä¸‰é‡": { x: 370, y: 450, s: 8, t: "rural" }, "äº¬éƒ½": { x: 330, y: 350, s: 12, t: "urban" },
    "å¥ˆè‰¯": { x: 330, y: 430, s: 6, t: "rural" }, "å¤§é˜ª": { x: 300, y: 400, s: 19, t: "urban" },
    "å’Œæ­Œå±±": { x: 290, y: 470, s: 5, t: "rural" }, "å…µåº«": { x: 270, y: 350, s: 12, t: "urban" },
    "é³¥å–": { x: 230, y: 310, s: 4, t: "rural" }, "å³¶æ ¹": { x: 180, y: 310, s: 4, t: "rural" },
    "å²¡å±±": { x: 230, y: 360, s: 10, t: "rural" }, "åºƒå³¶": { x: 180, y: 370, s: 12, t: "industry" },
    "å±±å£": { x: 130, y: 380, s: 8, t: "rural" }, "é¦™å·": { x: 220, y: 420, s: 6, t: "rural" },
    "å¾³å³¶": { x: 250, y: 460, s: 6, t: "rural" }, "æ„›åª›": { x: 170, y: 440, s: 8, t: "rural" },
    "é«˜çŸ¥": { x: 200, y: 480, s: 4, t: "rural" }, "ç¦å²¡": { x: 80, y: 380, s: 11, t: "urban" },
    "ä½è³€": { x: 40, y: 400, s: 4, t: "rural" }, "é•·å´": { x: 30, y: 440, s: 8, t: "rural" },
    "å¤§åˆ†": { x: 100, y: 440, s: 6, t: "rural" }, "ç†Šæœ¬": { x: 60, y: 460, s: 8, t: "rural" },
    "å®®å´": { x: 100, y: 500, s: 6, t: "rural" }, "é¹¿å…å³¶": { x: 60, y: 520, s: 9, t: "rural" },
    "æ²–ç¸„": { x: 50, y: 600, s: 4, t: "rural" }
};

let totalActions = 45;
let turnStep = 0; // 0,1,2
let day = 1;
const status = {};
let currentMode = null;

function init() {
    const map = document.getElementById("japan-map");
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.innerHTML = `<span>${p}</span>${PREF_DATA[p].s}`;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => clickPref(p);
        map.appendChild(d);
    });
    updateUI();
}

function log(msg) {
    const box = document.getElementById("news");
    box.innerHTML = `> ${msg}<br>${box.innerHTML}`;
}

function setAction(mode) {
    currentMode = mode;
    log(mode === 'speech' ? "æ¼”èª¬ã™ã‚‹çœŒã‚’é¸ã‚“ã§ãã ã•ã„ã€‚" : "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠä¸­...");
}

function clickPref(p) {
    if (currentMode === "speech") {
        status[p] = "you";
        log(`${p}ã§é­‚ã®æ¼”èª¬ï¼${PREF_DATA[p].s}è­°å¸­ã‚’ç¢ºä¿è¦‹è¾¼ã¿ã€‚`);
        endStep();
    } else if (currentMode === "home") {
        if (PREF_DATA[p].t === "rural") {
            status[p] = "you";
            log(`${p}ã®å…¨æˆ¸ã‚’è¨ªå•ã€‚åœ°å…ƒã®ä¿¡é ¼ã‚’å‹ã¡å–ã‚Šã¾ã—ãŸã€‚`);
            endStep();
        } else {
            alert("æˆ¸åˆ¥è¨ªå•ã¯ã€Œåœ°æ–¹(rural)ã€ã®çœŒã®ã¿æœ‰åŠ¹ã§ã™ã€‚");
        }
    }
}

function doSNS() {
    let hits = 0;
    Object.keys(status).forEach(p => {
        if (PREF_DATA[p].t === "urban" && status[p] === "neutral" && Math.random() > 0.8) {
            status[p] = "you";
            hits++;
        }
    });
    log(hits > 0 ? `SNSãŒãƒã‚ºã‚Šã€éƒ½å¸‚éƒ¨ã®${hits}åœ°åŸŸã§æ”¯æŒå¢—ï¼` : "SNSã®åå¿œã¯ã„ã¾ã²ã¨ã¤ã§ã—ãŸã€‚");
    endStep();
}

function doHome() {
    currentMode = "home";
    log("è¨ªå•ã™ã‚‹åœ°æ–¹ã®çœŒã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
}

function doTV() {
    let count = 0;
    Object.keys(status).forEach(p => {
        if (status[p] === "neutral" && Math.random() > 0.85) {
            status[p] = "you";
            count++;
        }
    });
    log(`ç”Ÿæ”¾é€ã«å‡ºæ¼”ã€‚å…¨å›½ã®${count}åœ°åŸŸã§ç„¡å…šæ´¾å±¤ã‚’å–ã‚Šè¾¼ã¿ã¾ã—ãŸã€‚`);
    endStep();
}

function doSurvey() {
    const you = calculateSeats("you");
    log(`ã€æƒ…å‹¢èª¿æŸ»ã€‘${you}è­°å¸­ã€‚éåŠæ•°(233)ã¾ã§ã‚ã¨${Math.max(0, 233-you)}ã§ã™ã€‚`);
    endStep();
}

function endStep() {
    currentMode = null;
    totalActions--;
    turnStep++;
    
    if (turnStep > 2) {
        aiAction();
        turnStep = 0;
        day++;
        checkEvent();
    }
    
    if (totalActions <= 0) {
        finishGame();
    } else {
        updateUI();
    }
}

function aiAction() {
    // AIã‚‚1æ—¥ã«3ç®‡æ‰€ç¨‹åº¦å¥ªã†ã€‚å¾ŒåŠã¯ã•ã‚‰ã«åŠ é€Ÿã€‚
    const speed = day > 10 ? 4 : 3;
    for(let i=0; i<speed; i++) {
        const targets = Object.keys(status).filter(k => status[k] === "neutral");
        if (targets.length > 0) {
            const t = targets[Math.floor(Math.random() * targets.length)];
            status[t] = "ai";
        }
    }
}

function checkEvent() {
    if (day % 3 === 0) {
        const events = [
            "ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‘æ€¥æ¿€ãªå††å®‰ãŒé€²è¡Œã€‚çµŒæ¸ˆæ”¿ç­–ã¸ã®é–¢å¿ƒãŒé«˜ã¾ã‚‹ï¼",
            "ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‘ä¸å…šã«ä¸ç¥¥äº‹ç™ºè¦šã‹ï¼Ÿé‡å…šã«è¿½ã„é¢¨ã®äºˆæ„Ÿã€‚",
            "ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‘è‹¥è€…ã®æŠ•ç¥¨æ„æ¬²ãŒå‘ä¸Šã€‚éƒ½å¸‚éƒ¨ã®æƒ…å‹¢ãŒä¸å®‰å®šã«ã€‚"
        ];
        log(events[Math.floor(Math.random() * events.length)]);
    }
}

function calculateSeats(owner) {
    return Object.keys(status).reduce((sum, p) => status[p] === owner ? sum + PREF_DATA[p].s : sum, 0);
}

function updateUI() {
    const you = calculateSeats("you");
    const ai = calculateSeats("ai");
    const neu = 465 - you - ai;
    const times = ["æœ", "æ˜¼", "å¤œ"];

    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barYou").textContent = you;
    document.getElementById("barAI").style.width = (ai / 465 * 100) + "%";
    document.getElementById("barAI").textContent = ai;
    document.getElementById("barNeutral").style.width = (neu / 465 * 100) + "%";
    document.getElementById("barNeutral").textContent = neu;

    document.getElementById("timeDisplay").textContent = `${day}æ—¥ç›®ï¼š${times[turnStep]}`;
    document.getElementById("turnInfo").textContent = `æ®‹ã‚Š ${totalActions} ã‚¢ã‚¯ã‚·ãƒ§ãƒ³`;

    Object.keys(status).forEach(p => {
        document.getElementById(`pref-${p}`).className = `pref ${status[p]}`;
    });
}

function finishGame() {
    // æœ€çµ‚åˆ¤å®šï¼šä¸­ç«‹ã‚’ã™ã¹ã¦AIã‹è‡ªåˆ†ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹
    Object.keys(status).forEach(p => {
        if (status[p] === "neutral") status[p] = Math.random() > 0.5 ? "you" : "ai";
    });
    updateUI();
    
    const you = calculateSeats("you");
    const modal = document.getElementById("resultModal");
    modal.style.display = "flex";
    document.getElementById("finalSeats").textContent = `${you} è­°å¸­`;
    
    if (you >= 233) {
        document.getElementById("resultTitle").textContent = "âœ¨ åœ§å‹ï¼å˜ç‹¬éåŠæ•° âœ¨";
        document.getElementById("resultText").textContent = "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ã‚ãªãŸã®æ”¿å…šãŒæ—¥æœ¬ã‚’å‹•ã‹ã—ã¾ã™ã€‚";
    } else if (you > 150) {
        document.getElementById("resultTitle").textContent = "ğŸ¤ é€£ç«‹æ”¿æ¨©ã®æ¨¡ç´¢ ğŸ¤";
        document.getElementById("resultText").textContent = "éåŠæ•°ã«ã¯å±Šãã¾ã›ã‚“ã§ã—ãŸãŒã€ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒœãƒ¼ãƒˆã‚’æ¡ã‚Šã¾ã—ãŸã€‚";
    } else {
        document.getElementById("resultTitle").textContent = "â— é¸æŒ™ã«æ•—åŒ— â—";
        document.getElementById("resultText").textContent = "å³ã—ã„å¯©åˆ¤ãŒä¸‹ã•ã‚Œã¾ã—ãŸã€‚ä¸€ã‹ã‚‰å‡ºç›´ã—ã§ã™ã€‚";
    }
}

window.onload = init;
</script>
</body>
</html>
