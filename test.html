<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼šçœŸãƒ»äº¤äº’ã‚¿ãƒ¼ãƒ³ç‰ˆ</title>
    <style>
        :root { --you: #22c55e; --ai: #f97316; --neu: #475569; }
        body { margin: 0; background: #0f172a; color: #e5e7eb; font-family: 'Hiragino Sans', 'Meiryo', sans-serif; overflow: hidden; }
        
        /* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: flex; height: 82vh; }
        .map-area { flex: 2.5; position: relative; background: #1e293b; overflow: auto; border-bottom: 2px solid #334155; }
        .side { flex: 1; background: #111827; padding: 15px; border-left: 2px solid #334155; display: flex; flex-direction: column; gap: 10px; }
        
        /* åœ°å›³ */
        .japan-map { position: relative; width: 950px; height: 700px; margin: 0 auto; background: #0f172a; scale: 0.85; transform-origin: top center; }
        .pref { position: absolute; width: 65px; height: 45px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; border-radius: 6px; cursor: pointer; transition: 0.2s; color: white; border: 1px solid rgba(255,255,255,0.2); z-index: 5; }
        .pref b { font-size: 13px; }
        .pref small { font-size: 9px; opacity: 0.9; }
        .pref.neutral { background: var(--neu); }
        .pref.you { background: var(--you); box-shadow: 0 0 15px var(--you); z-index: 10; border-color: white; }
        .pref.ai { background: var(--ai); box-shadow: 0 0 15px var(--ai); z-index: 10; border-color: white; }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»çŠ¶æ…‹ */
        .header-info { display: flex; justify-content: space-between; padding: 10px 20px; background: #0f172a; font-weight: bold; }
        .turn-display { background: #facc15; color: #000; padding: 12px; text-align: center; border-radius: 8px; font-weight: 900; font-size: 1.2rem; border: 2px solid #000; }
        .news-box { background: #000; padding: 10px; border-radius: 8px; flex-grow: 1; border: 1px solid #3b82f6; overflow-y: auto; font-family: monospace; color: #34d399; font-size: 0.9rem; }
        .breaking-news { color: #ff4500; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* ãƒœã‚¿ãƒ³ */
        .actions button { width: 100%; padding: 12px; margin-bottom: 8px; background: #334155; color: white; border: 2px solid #475569; border-radius: 8px; cursor: pointer; text-align: left; font-size: 0.9rem; }
        .actions button:hover:not(:disabled) { background: #475569; border-color: #3b82f6; }
        .actions button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* è­°å¸­ãƒãƒ¼ */
        .seat-bar-container { height: 18vh; background: #0f172a; padding: 10px 50px; }
        .seat-bar { height: 45px; background: #334155; display: flex; position: relative; border-radius: 25px; overflow: hidden; border: 3px solid #000; }
        .bar { transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; }
        .bar.you { background: var(--you); }
        .bar.ai { background: var(--ai); }
        .majority-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #fff; z-index: 20; }
        
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:2000; }
        .modal-content { background:#1e293b; padding:40px; border-radius:20px; text-align:center; border:5px solid var(--you); }
    </style>
</head>
<body>

<div class="header-info">
    <div>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼2026</div>
    <div id="timeDisplay">1æ—¥ç›®ï¼šæœ</div>
</div>

<div class="container">
    <div class="map-area">
        <div id="japan-map" class="japan-map"></div>
    </div>

    <div class="side">
        <div class="turn-display" id="turnIndicator">ã‚ãªãŸã®ç•ªã§ã™</div>
        
        <div class="actions" id="actionPanel">
            <button onclick="setMode('speech')">ğŸ¤ è¡—é ­æ¼”èª¬<br><small>é¸ã‚“ã çœŒã‚’ç¢ºå®Ÿã«ç²å¾—ã—ã¾ã™</small></button>
            <button onclick="doSNS()">ğŸ“± SNSæˆ¦ç•¥<br><small>éƒ½å¸‚éƒ¨(æ±äº¬ãªã©)ã®æ”¯æŒã‚’å°‘ã—ãšã¤åºƒã’ã¾ã™</small></button>
            <button onclick="doTV()">ğŸ“º ãƒ†ãƒ¬ãƒ“å‡ºæ¼”<br><small>å…¨å›½ã®ç„¡å…šæ´¾å±¤ã‚’ã‚ãšã‹ã«å–ã‚Šè¾¼ã¿ã¾ã™</small></button>
            <button onclick="doSurvey()">ğŸ“Š æƒ…å‹¢èª¿æŸ»<br><small>ç¾åœ¨ã®äºˆæ¸¬è­°å¸­ã‚’è©³ã—ãåˆ†æã—ã¾ã™</small></button>
        </div>

        <div class="news-box" id="newsFeed">
            <div>ã€å…¬ç¤ºã€‘465è­°å¸­ã‚’å·¡ã‚‹æˆ¦ã„ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚</div>
        </div>
    </div>
</div>

<div class="seat-bar-container">
    <div style="text-align:center; margin-bottom:5px; font-weight:bold;">è­°å¸­äºˆæ¸¬ï¼ˆéåŠæ•°ï¼š233ï¼‰</div>
    <div class="seat-bar">
        <div id="barYou" class="bar you" style="width: 0%">0</div>
        <div id="barNeutral" class="bar neutral" style="width: 100%">465</div>
        <div id="barAI" class="bar ai" style="width: 0%">0</div>
        <div class="majority-line"></div>
    </div>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h1 id="resultTitle"></h1>
        <h2 id="finalSeats"></h2>
        <p id="resultText"></p>
        <button onclick="location.reload()" style="background:var(--you); color:white; padding:15px 30px; border:none; border-radius:8px; cursor:pointer;">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>
</div>

<script>
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 750, y: 50, s: 17, t: "rural" }, "é’æ£®": { x: 750, y: 180, s: 6, t: "rural" },
    "å²©æ‰‹": { x: 830, y: 220, s: 6, t: "rural" }, "ç§‹ç”°": { x: 670, y: 220, s: 5, t: "rural" },
    "å±±å½¢": { x: 670, y: 300, s: 6, t: "rural" }, "å®®åŸ": { x: 830, y: 300, s: 10, t: "rural" },
    "ç¦å³¶": { x: 750, y: 350, s: 9, t: "rural" }, "æ–°æ½Ÿ": { x: 580, y: 280, s: 10, t: "rural" },
    "å¯Œå±±": { x: 480, y: 280, s: 6, t: "rural" }, "çŸ³å·": { x: 400, y: 280, s: 6, t: "rural" },
    "ç¦äº•": { x: 350, y: 350, s: 4, t: "rural" }, "é•·é‡": { x: 520, y: 350, s: 10, t: "rural" },
    "ç¾¤é¦¬": { x: 620, y: 380, s: 10, t: "rural" }, "æ ƒæœ¨": { x: 700, y: 400, s: 10, t: "rural" },
    "èŒ¨åŸ": { x: 800, y: 430, s: 13, t: "rural" }, "åŸ¼ç‰": { x: 650, y: 460, s: 28, t: "urban" },
    "æ±äº¬": { x: 650, y: 550, s: 30, t: "urban" }, "åƒè‘‰": { x: 780, y: 550, s: 22, t: "urban" },
    "ç¥å¥ˆå·": { x: 550, y: 580, s: 26, t: "urban" }, "å±±æ¢¨": { x: 500, y: 480, s: 4, t: "rural" },
    "é™å²¡": { x: 450, y: 550, s: 16, t: "urban" }, "æ„›çŸ¥": { x: 400, y: 480, s: 15, t: "industry" },
    "å²é˜œ": { x: 420, y: 400, s: 10, t: "rural" }, "æ»‹è³€": { x: 350, y: 430, s: 4, t: "rural" },
    "ä¸‰é‡": { x: 380, y: 580, s: 8, t: "rural" }, "å¥ˆè‰¯": { x: 300, y: 530, s: 6, t: "rural" },
    "å’Œæ­Œå±±": { x: 280, y: 620, s: 5, t: "rural" }, "äº¬éƒ½": { x: 280, y: 430, s: 12, t: "urban" },
    "å¤§é˜ª": { x: 200, y: 500, s: 19, t: "urban" }, "å…µåº«": { x: 200, y: 400, s: 12, t: "urban" },
    "é³¥å–": { x: 130, y: 350, s: 4, t: "rural" }, "å³¶æ ¹": { x: 30, y: 350, s: 4, t: "rural" },
    "å²¡å±±": { x: 130, y: 430, s: 10, t: "rural" }, "åºƒå³¶": { x: 50, y: 430, s: 12, t: "industry" },
    "å±±å£": { x: 30, y: 520, s: 8, t: "rural" }, "é¦™å·": { x: 130, y: 550, s: 6, t: "rural" },
    "æ„›åª›": { x: 30, y: 580, s: 8, t: "rural" }, "å¾³å³¶": { x: 210, y: 600, s: 6, t: "rural" },
    "é«˜çŸ¥": { x: 130, y: 630, s: 4, t: "rural" }, "ç¦å²¡": { x: 100, y: 250, s: 11, t: "urban" },
    "ä½è³€": { x: 20, y: 220, s: 4, t: "rural" }, "é•·å´": { x: 20, y: 280, s: 8, t: "rural" },
    "ç†Šæœ¬": { x: 100, y: 180, s: 8, t: "rural" }, "å¤§åˆ†": { x: 180, y: 220, s: 6, t: "rural" },
    "å®®å´": { x: 180, y: 130, s: 6, t: "rural" }, "é¹¿å…å³¶": { x: 100, y: 100, s: 9, t: "rural" },
    "æ²–ç¸„": { x: 20, y: 50, s: 4, t: "rural" }
};

let day = 1;
let turnStep = 0; // 0:æœ, 1:æ˜¼, 2:å¤œ
let isPlayerTurn = true;
let actionPoints = 45;
const status = {};
let currentMode = null;

function init() {
    const map = document.getElementById("japan-map");
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.innerHTML = `<b>${p}</b><small>(${PREF_DATA[p].s})</small>`;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => handleMapClick(p);
        map.appendChild(d);
    });
    updateUI();
}

function log(msg, isBreaking = false) {
    const box = document.getElementById("newsFeed");
    const div = document.createElement("div");
    if (isBreaking) div.className = "breaking-news";
    div.innerHTML = `> ${msg}`;
    box.prepend(div);
}

function setMode(m) {
    if (!isPlayerTurn) return;
    currentMode = m;
    log("åœ°å›³ã‹ã‚‰éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
}

function handleMapClick(p) {
    if (!isPlayerTurn || currentMode !== "speech") return;
    status[p] = "you";
    log(`${p}ã§æ¼”èª¬ã€‚æ”¯æŒã‚’å›ºã‚ã¾ã—ãŸã€‚`);
    endTurn();
}

function doSNS() {
    if (!isPlayerTurn) return;
    let success = false;
    const urbans = Object.keys(PREF_DATA).filter(p => PREF_DATA[p].t === "urban" && status[p] === "neutral");
    if (urbans.length > 0) {
        const target = urbans[Math.floor(Math.random() * urbans.length)];
        status[target] = "you";
        log(`SNSæˆ¦ç•¥ãŒæˆåŠŸï¼${target}ã®ç„¡å…šæ´¾å±¤ãŒå‹•ãã¾ã—ãŸã€‚`);
        success = true;
    }
    if (!success) log("SNSã§ã®åå¿œã¯è–„ã„ã‚ˆã†ã§ã™ã€‚");
    endTurn();
}

function doTV() {
    if (!isPlayerTurn) return;
    const neutrals = Object.keys(status).filter(p => status[p] === "neutral");
    if (neutrals.length > 0 && Math.random() > 0.4) {
        const target = neutrals[Math.floor(Math.random() * neutrals.length)];
        status[target] = "you";
        log(`ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ã§${target}ã®æ”¯æŒãŒå‘ä¸Šã€‚`);
    } else {
        log("ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ã—ã¾ã—ãŸãŒã€å¤§ããªå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
    }
    endTurn();
}

function doSurvey() {
    if (!isPlayerTurn) return;
    const you = calculateSeats("you");
    log(`ã€èª¿æŸ»çµæœã€‘ç¾åœ¨${you}è­°å¸­ç¢ºä¿ã®å‹¢ã„ã§ã™ã€‚`);
    endTurn();
}

function endTurn() {
    currentMode = null;
    isPlayerTurn = false;
    actionPoints--;
    updateUI();
    
    // AIã®ã‚¿ãƒ¼ãƒ³ã¸
    document.getElementById("turnIndicator").textContent = "ç›¸æ‰‹ã®ç•ªã§ã™...";
    document.getElementById("turnIndicator").style.background = "#f97316";
    
    setTimeout(aiTurn, 1000);
}

function aiTurn() {
    const neutrals = Object.keys(status).filter(p => status[p] === "neutral");
    if (neutrals.length > 0) {
        const target = neutrals[Math.floor(Math.random() * neutrals.length)];
        status[target] = "ai";
        log(`ç›¸æ‰‹å€™è£œãŒ${target}ã§æ”¯æŒã‚’åºƒã’ã¾ã—ãŸã€‚`);
    }
    
    // ã‚¿ãƒ¼ãƒ³ã®é€²è¡Œ
    turnStep++;
    if (turnStep > 2) {
        turnStep = 0;
        day++;
    }
    
    // ãƒ©ãƒ³ãƒ€ãƒ ä¸ç¥¥äº‹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ10%ã®ç¢ºç‡ï¼‰
    if (Math.random() < 0.15) {
        triggerScandal();
    }

    if (actionPoints <= 0 || Object.keys(status).filter(p => status[p] === "neutral").length === 0) {
        finishGame();
    } else {
        isPlayerTurn = true;
        document.getElementById("turnIndicator").textContent = "ã‚ãªãŸã®ç•ªã§ã™";
        document.getElementById("turnIndicator").style.background = "#facc15";
        updateUI();
    }
}

function triggerScandal() {
    const isYou = Math.random() > 0.5;
    const targetSide = isYou ? "you" : "ai";
    const affected = Object.keys(status).filter(p => status[p] === targetSide);
    
    if (affected.length > 0) {
        const p = affected[Math.floor(Math.random() * affected.length)];
        status[p] = isYou ? "ai" : "you"; // æ”¯æŒãŒé€†è»¢
        const party = isYou ? "ã‚ãªãŸã®å…š" : "ç›¸æ‰‹ã®å…š";
        log(`ã€é€Ÿå ±ã€‘${party}ã«ä¸ç¥¥äº‹ç™ºè¦šï¼${p}ã®æ”¯æŒãŒé›¢åã—ã¾ã—ãŸã€‚`, true);
    }
}

function calculateSeats(owner) {
    return Object.keys(status).reduce((sum, p) => status[p] === owner ? sum + PREF_DATA[p].s : sum, 0);
}

function updateUI() {
    const you = calculateSeats("you");
    const ai = calculateSeats("ai");
    const neu = 465 - you - ai;
    const times = ["æœ", "æ˜¼", "å¤œ"];

    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barYou").textContent = you;
    document.getElementById("barAI").style.width = (ai / 465 * 100) + "%";
    document.getElementById("barAI").textContent = ai;
    document.getElementById("barNeutral").style.width = (neu / 465 * 100) + "%";
    document.getElementById("barNeutral").textContent = neu;

    document.getElementById("timeDisplay").textContent = `${day}æ—¥ç›®ï¼š${times[turnStep]}`;
    
    Object.keys(status).forEach(p => {
        document.getElementById(`pref-${p}`).className = `pref ${status[p]}`;
    });

    const panel = document.getElementById("actionPanel");
    const btns = panel.getElementsByTagName("button");
    for(let b of btns) b.disabled = !isPlayerTurn;
}

function finishGame() {
    // æœ€çµ‚å‡¦ç†ï¼šä¸­ç«‹ã‚’åˆ†ã‘ã‚‹
    Object.keys(status).forEach(p => {
        if (status[p] === "neutral") status[p] = Math.random() > 0.5 ? "you" : "ai";
    });
    updateUI();
    
    const you = calculateSeats("you");
    document.getElementById("resultModal").style.display = "flex";
    document.getElementById("finalSeats").textContent = `${you} è­°å¸­`;
    
    if (you >= 233) {
        document.getElementById("resultTitle").textContent = "âœ¨ åœ§å‹ï¼å˜ç‹¬éåŠæ•°ç²å¾— âœ¨";
        document.getElementById("resultText").textContent = "æ–°ã—ã„ãƒªãƒ¼ãƒ€ãƒ¼ã®èª•ç”Ÿã§ã™ã€‚";
    } else {
        document.getElementById("resultTitle").textContent = "â— é¸æŒ™ã«æ•—åŒ— â—";
        document.getElementById("resultText").textContent = "éåŠæ•°ã«å±Šã‹ãšã€é‡å…šã¨ãªã‚Šã¾ã—ãŸã€‚";
    }
}

window.onload = init;
</script>
</body>
</html>
