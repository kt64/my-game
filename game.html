<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼2026 - 47éƒ½é“åºœçœŒå®Œå…¨ç‰ˆ</title>
<style>
body{
  margin:0;
  font-family:"Hiragino Sans","Meiryo",sans-serif;
  background:#020617;
  color:#f8fafc;
  overflow: hidden;
}
h1,h2,h3{margin:0 0 10px 0}
button{
  padding:12px 16px;
  margin:5px 0;
  border:none;
  border-radius:8px;
  background:#facc15;
  color: #000;
  font-weight:bold;
  cursor:pointer;
  width: 100%;
  text-align: left;
}
button:hover:not(:disabled){ background: #fde047; }
button:disabled{opacity:.3;cursor:not-allowed}

.screen{display:none;padding:20px; height: 100vh; box-sizing: border-box;}
.screen.active{display:block}

.card{ background:#0f172a; padding:20px; border-radius:12px; margin-bottom:15px; border: 1px solid #1e293b; }
input{padding:10px; width:90%; border-radius: 5px; border: none; margin-top: 10px;}

.layout{display:flex; gap:20px; height: 80vh;}

/* åœ°å›³ã‚¨ãƒªã‚¢ */
.map-container {
  flex: 1;
  background: #020617;
  position: relative;
  overflow: auto;
  border: 2px solid #1e293b;
  border-radius: 12px;
}
.map{ position:relative; width:950px; height:800px; padding: 20px; }
.pref{
  position:absolute;
  width:75px;
  height:50px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.3);
  text-align:center;
  font-size:.75rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
  cursor:pointer;
  transition: 0.3s;
}
.neutral{background:#334155; color: #94a3b8;}
.you{background:#22c55e; color:#000; font-weight: bold; box-shadow: 0 0 15px #22c55e; border-color: #fff; z-index: 10;}
.ai{background:#ef4444; color:#fff; font-weight: bold; box-shadow: 0 0 15px #ef4444; border-color: #fff; z-index: 10;}

/* å³ãƒ‘ãƒãƒ« */
.side{width:350px; display: flex; flex-direction: column; gap: 10px;}
.turn-indicator { 
    background: #facc15; color: #000; padding: 10px; border-radius: 8px; 
    text-align: center; font-weight: 900; font-size: 1.2rem;
}
.news-box {
  background: #000;
  border: 1px solid #3b82f6;
  padding: 10px;
  font-size: .85rem;
  height: 150px;
  overflow-y: auto;
  color: #34d399;
  font-family: monospace;
}
.breaking { color: #ff4444; font-weight: bold; animation: blink 0.8s infinite; }
@keyframes blink { 50% { opacity: 0.3; } }

.seats-display { font-size: 1.1rem; font-weight: bold; border-top: 2px solid #334155; padding-top: 10px; }
</style>
</head>
<body>

<div id="setup" class="screen active">
  <h1>è¡†é™¢é¸2026ï¼šé¸æŒ™äº‹å‹™æ‰€</h1>
  <div class="card">
    <h3>1. å…šåã‚’æ±ºã‚ã‚‹</h3>
    <input id="partyName" placeholder="ä¾‹ï¼šæœªæ¥æ—¥æœ¬å…š" value="ã‚ãªãŸå…š">
  </div>
  <div class="card">
    <h3>2. ä¸»è¦å…¬ç´„ï¼ˆ5ã¤é¸æŠï¼‰</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
      <label><input type="checkbox" value="ç¤¾ä¼šä¿éšœ"> ç¤¾ä¼šä¿éšœ</label>
      <label><input type="checkbox" value="çµŒæ¸ˆæˆé•·"> çµŒæ¸ˆæˆé•·</label>
      <label><input type="checkbox" value="æ•™è‚²ç„¡å„ŸåŒ–"> æ•™è‚²ç„¡å„ŸåŒ–</label>
      <label><input type="checkbox" value="é˜²è¡›åŠ›å¼·åŒ–"> é˜²è¡›åŠ›å¼·åŒ–</label>
      <label><input type="checkbox" value="è„±ç‚­ç´ "> è„±ç‚­ç´ </label>
      <label><input type="checkbox" value="æ¸›ç¨"> æ¸›ç¨</label>
      <label><input type="checkbox" value="åœ°æ–¹å‰µç”Ÿ"> åœ°æ–¹å‰µç”Ÿ</label>
      <label><input type="checkbox" value="æ”¿æ²»æ”¹é©"> æ”¿æ²»æ”¹é©</label>
    </div>
  </div>
  <button onclick="startGame()" style="text-align:center; font-size:1.2rem; background:#22c55e; color:white;">é¸æŒ™æˆ¦ã‚’é–‹å§‹ã™ã‚‹ï¼</button>
</div>

<div id="game" class="screen">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
    <h2 id="title"></h2>
    <div id="dayDisplay" style="font-weight:bold; color:#facc15;"></div>
  </div>

  <div class="layout">
    <div class="map-container">
        <div class="map" id="map"></div>
    </div>

    <div class="side">
      <div id="turnIndicator" class="turn-indicator">ã‚ãªãŸã®ç•ªã§ã™</div>
      
      <div id="actionButtons">
        <button onclick="prepareAction('speech')">ğŸ¤ è¡—é ­æ¼”èª¬ï¼ˆçœŒã‚’é¸æŠï¼‰</button>
        <button onclick="runDirectAction('sns')">ğŸ“± SNSæˆ¦ç•¥ï¼ˆéƒ½å¸‚éƒ¨ã‚’ç‹™ã†ï¼‰</button>
        <button onclick="runDirectAction('home')">ğŸ  æˆ¸åˆ¥è¨ªå•ï¼ˆåœ°æ–¹ã‚’å›ºã‚ã‚‹ï¼‰</button>
        <button onclick="runDirectAction('tv')">ğŸ“º ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ï¼ˆä¸­ç«‹ã‚’å‹•ã‹ã™ï¼‰</button>
        <button onclick="runDirectAction('flyer')">ğŸ“„ æ”¿ç­–ãƒ“ãƒ©ï¼ˆå…¨å›½ã¸é…å¸ƒï¼‰</button>
      </div>

      <div class="news-box" id="news">
        <div>> å…¬ç¤ºæ—¥ã€‚ã„ã‚ˆã„ã‚ˆã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ã€‚</div>
      </div>

      <div class="seats-display">
        <div id="seatCounts"></div>
        <div style="font-size:0.8rem; color:#94a3b8; margin-top:5px;">éåŠæ•°ï¼š233 / å…¨465è­°å¸­</div>
      </div>
    </div>
  </div>
</div>

<script>
/* 47éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ï¼ˆé‡ãªã‚‰ãªã„ã‚ˆã†é…ç½®ï¼‰ */
const PREFS_DATA = {
    "åŒ—æµ·é“": {x:750, y:20, s:17, t:"rural"}, "é’æ£®": {x:750, y:120, s:6, t:"rural"},
    "å²©æ‰‹": {x:840, y:160, s:6, t:"rural"}, "ç§‹ç”°": {x:660, y:160, s:5, t:"rural"},
    "å±±å½¢": {x:680, y:240, s:6, t:"rural"}, "å®®åŸ": {x:820, y:240, s:10, t: "rural"},
    "ç¦å³¶": {x:750, y:310, s:9, t:"rural"}, "æ–°æ½Ÿ": {x:570, y:210, s:10, t:"rural"},
    "å¯Œå±±": {x:480, y:210, s:6, t:"rural"}, "çŸ³å·": {x:390, y:210, s:6, t:"rural"},
    "ç¦äº•": {x:330, y:270, s:4, t:"rural"}, "é•·é‡": {x:500, y:310, s:10, t:"rural"},
    "ç¾¤é¦¬": {x:600, y:330, s:10, t:"rural"}, "æ ƒæœ¨": {x:680, y:380, s:10, t:"rural"},
    "èŒ¨åŸ": {x:780, y:420, s:13, t:"rural"}, "åŸ¼ç‰": {x:600, y:440, s:28, t:"urban"},
    "æ±äº¬": {x:680, y:520, s:30, t:"urban"}, "åƒè‘‰": {x:790, y:530, s:22, t:"urban"},
    "ç¥å¥ˆå·": {x:570, y:570, s:26, t:"urban"}, "å±±æ¢¨": {x:490, y:420, s:4, t:"rural"},
    "é™å²¡": {x:470, y:530, s:16, t:"urban"}, "æ„›çŸ¥": {x:390, y:470, s:15, t:"urban"},
    "å²é˜œ": {x:400, y:370, s:10, t:"rural"}, "æ»‹è³€": {x:320, y:350, s:4, t:"rural"},
    "ä¸‰é‡": {x:340, y:580, s:8, t:"rural"}, "å¥ˆè‰¯": {x:280, y:510, s:6, t:"rural"},
    "å’Œæ­Œå±±": {x:230, y:630, s:5, t:"rural"}, "äº¬éƒ½": {x:260, y:370, s:12, t:"urban"},
    "å¤§é˜ª": {x:190, y:460, s:19, t:"urban"}, "å…µåº«": {x:170, y:360, s:12, t:"urban"},
    "é³¥å–": {x:100, y:290, s:4, t:"rural"}, "å³¶æ ¹": {x:10, y:290, s:4, t:"rural"},
    "å²¡å±±": {x:100, y:370, s:10, t:"rural"}, "åºƒå³¶": {x:10, y:370, s:12, t:"rural"},
    "å±±å£": {x:10, y:470, s:8, t:"rural"}, "å¾³å³¶": {x:150, y:580, s:6, t:"rural"},
    "é¦™å·": {x:80, y:540, s:6, t:"rural"}, "æ„›åª›": {x:10, y:580, s:8, t:"rural"},
    "é«˜çŸ¥": {x:80, y:640, s:4, t:"rural"}, "ç¦å²¡": {x:100, y:150, s:11, t:"urban"},
    "ä½è³€": {x:10, y:140, s:4, t:"rural"}, "é•·å´": {x:10, y:210, s:8, t:"rural"},
    "ç†Šæœ¬": {x:100, y:250, s:8, t:"rural"}, "å¤§åˆ†": {x:190, y:210, s:6, t:"rural"},
    "å®®å´": {x:190, y:120, s:6, t:"rural"}, "é¹¿å…å³¶": {x:100, y:50, s:9, t:"rural"},
    "æ²–ç¸„": {x:10, y:40, s:4, t:"rural"}
};

let status = {}, turnsLeft = 45, day = 1, isPlayerTurn = true, partyName = "", activeMode = null;

function startGame(){
  const checks = document.querySelectorAll("input:checked");
  if(checks.length !== 5){ alert("å…¬ç´„ã¯5ã¤é¸ã‚“ã§ãã ã•ã„"); return; }
  partyName = document.getElementById("partyName").value || "ã‚ãªãŸå…š";
  
  document.getElementById("setup").classList.remove("active");
  document.getElementById("game").classList.add("active");
  document.getElementById("title").textContent = partyName + " å…¨å‹ã¸ã®é“";
  
  initMap();
  updateUI();
}

function initMap(){
  const map = document.getElementById("map");
  map.innerHTML = "";
  Object.keys(PREFS_DATA).forEach(name => {
    status[name] = "neutral";
    const p = PREFS_DATA[name];
    const d = document.createElement("div");
    d.className = "pref neutral";
    d.id = `pref-${name}`;
    d.style.left = p.x + "px";
    d.style.top = p.y + "px";
    d.innerHTML = `<span>${name}</span><span style="font-size:0.6rem;">(${p.s})</span>`;
    d.onclick = () => onPrefClick(name);
    map.appendChild(d);
  });
}

function prepareAction(mode){
    if(!isPlayerTurn) return;
    activeMode = mode;
    log("åœ°å›³ã‹ã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®çœŒã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚");
}

function onPrefClick(name){
    if(!isPlayerTurn || activeMode !== 'speech') return;
    status[name] = "you";
    log(`${name}ã§ç†±ã®ã“ã‚‚ã£ãŸæ¼”èª¬ã‚’è¡Œã„ã€æ”¯æŒã‚’å›ºã‚ã¾ã—ãŸï¼`);
    endPlayerTurn();
}

function runDirectAction(type){
    if(!isPlayerTurn) return;
    let target = "";
    if(type === 'sns'){
        const list = Object.keys(status).filter(p => PREFS_DATA[p].t === 'urban' && status[p] !== 'you');
        target = list[Math.floor(Math.random() * list.length)];
        log(`SNSã§ã®ãƒã‚ºãŒç™ºç”Ÿï¼ ${target}ã®æ”¯æŒãŒæ€¥å¢—ã€‚`);
    } else if(type === 'home'){
        const list = Object.keys(status).filter(p => PREFS_DATA[p].t === 'rural' && status[p] !== 'you');
        target = list[Math.floor(Math.random() * list.length)];
        log(`åœ°é“ãªæˆ¸åˆ¥è¨ªå•ãŒåŠŸã‚’å¥ã—ã€${target}ã‚’ç¢ºä¿ã€‚`);
    } else {
        const list = Object.keys(status).filter(p => status[p] === 'neutral');
        target = list[Math.floor(Math.random() * list.length)] || Object.keys(status)[0];
        log(`${type === 'tv' ? 'å…¨å›½æ”¾é€' : 'ãƒ“ãƒ©é…å¸ƒ'}ã§${target}ã«åå‰ãŒå£²ã‚Œã¾ã—ãŸã€‚`);
    }
    if(target) status[target] = "you";
    endPlayerTurn();
}

function endPlayerTurn(){
    activeMode = null;
    isPlayerTurn = false;
    turnsLeft--;
    updateUI();
    
    document.getElementById("turnIndicator").textContent = "ç›¸æ‰‹ï¼ˆAIï¼‰ãŒè¡Œå‹•ä¸­...";
    document.getElementById("turnIndicator").style.background = "#ef4444";
    document.getElementById("turnIndicator").style.color = "#fff";
    
    setTimeout(aiTurn, 1000);
}

function aiTurn(){
    const targets = Object.keys(status).filter(p => status[p] !== 'ai');
    if(targets.length){
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "ai";
        log(`ã€è­¦å‘Šã€‘ç›¸æ‰‹å€™è£œãŒ${p}ã«ä¹—ã‚Šè¾¼ã¿ã€æ”¯æŒã‚’å¥ªã‚ã‚Œã¾ã—ãŸã€‚`);
    }

    // ãƒ©ãƒ³ãƒ€ãƒ ä¸ç¥¥äº‹ã‚¤ãƒ™ãƒ³ãƒˆ
    if(Math.random() < 0.15){
        triggerScandal();
    }

    if(turnsLeft % 3 === 0) day++;
    isPlayerTurn = true;
    document.getElementById("turnIndicator").textContent = "ã‚ãªãŸã®ç•ªã§ã™";
    document.getElementById("turnIndicator").style.background = "#facc15";
    document.getElementById("turnIndicator").style.color = "#000";
    updateUI();
}

function triggerScandal(){
    const myPrefs = Object.keys(status).filter(p => status[p] === 'you');
    if(myPrefs.length){
        const p = myPrefs[Math.floor(Math.random() * myPrefs.length)];
        status[p] = "ai"; // æ”¯æŒãŒå¥ªã‚ã‚Œã‚‹
        log(`ã€é€Ÿå ±ã€‘${partyName}ã«ä¸ç¥¥äº‹ï¼${p}ã®æƒ…å‹¢ãŒä¸åˆ©ã«ã€‚`, true);
    }
}

function updateUI(){
    let youSeats = 0, aiSeats = 0;
    Object.keys(status).forEach(name => {
        const d = document.getElementById(`pref-${name}`);
        d.className = `pref ${status[name]}`;
        if(status[name] === "you") youSeats += PREFS_DATA[name].s;
        if(status[name] === "ai") aiSeats += PREFS_DATA[name].s;
    });

    document.getElementById("seatCounts").innerHTML = 
        `<span style="color:#22c55e">${partyName}: ${youSeats}</span><br>` +
        `<span style="color:#ef4444">ç›¸æ‰‹å…šé€£åˆ: ${aiSeats}</span>`;
    
    document.getElementById("dayDisplay").textContent = `${day}æ—¥ç›® (æ®‹ã‚Š${turnsLeft}è¡Œå‹•)`;

    const buttons = document.querySelectorAll("#actionButtons button");
    buttons.forEach(b => b.disabled = !isPlayerTurn);

    if(turnsLeft <= 0){
        alert(`æŠ•é–‹ç¥¨çµ‚äº†ï¼\n${partyName}ã®ç²å¾—è­°å¸­ï¼š${youSeats}\n${youSeats >= 233 ? "éåŠæ•°é”æˆï¼æ­´å²çš„ãªå‹åˆ©ã§ã™ï¼" : "æ®‹å¿µãªãŒã‚‰éåŠæ•°ã«å±Šãã¾ã›ã‚“ã§ã—ãŸã€‚"}`);
        location.reload();
    }
}

function log(msg, isBreaking = false){
  const n = document.getElementById("news");
  const d = document.createElement("div");
  if(isBreaking) d.className = "breaking";
  d.innerHTML = (isBreaking ? "ã€é€Ÿå ±ã€‘" : "> ") + msg;
  n.prepend(d);
}
</script>
</body>
</html>
