<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡†é™¢é¸æ±ºæˆ¦2026 - æœ€çµ‚å®Œå…¨ç‰ˆ</title>
    <style>
        :root { --you: #00ff41; --ai: #ff4500; --neu: #334155; }
        body { margin: 0; background: #020617; color: #f8fafc; font-family: 'Hiragino Sans', 'Meiryo', sans-serif; }
        
        /* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container { display: flex; height: 85vh; padding: 10px; gap: 10px; }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ï¼ˆé‡ãªã‚Šé˜²æ­¢ã®ãŸã‚åºƒã‚ã«ç¢ºä¿ï¼‰ */
        .map-area { flex: 2.5; position: relative; background: #0f172a; border: 2px solid #1e293b; border-radius: 15px; overflow: auto; padding: 20px; }
        .japan-map { position: relative; width: 1000px; height: 850px; }

        /* éƒ½é“åºœçœŒãƒ‘ãƒãƒ«ï¼ˆå¤§ããã€é‡ãªã‚‰ãªã„ï¼‰ */
        .pref { 
            position: absolute; width: 85px; height: 50px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-radius: 8px; cursor: pointer; transition: 0.3s; font-weight: bold; border: 1px solid rgba(255,255,255,0.3);
        }
        .pref b { font-size: 14px; }
        .pref span { font-size: 11px; opacity: 0.8; }
        .pref.neutral { background: var(--neu); color: #fff; }
        .pref.you { background: var(--you); color: #000; box-shadow: 0 0 20px var(--you); border-color: #fff; z-index: 10; }
        .pref.ai { background: var(--ai); color: #fff; box-shadow: 0 0 20px var(--ai); border-color: #fff; z-index: 10; }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .side { flex: 1; background: #1e293b; padding: 20px; display: flex; flex-direction: column; gap: 15px; border-radius: 15px; }
        .turn-display { 
            background: #facc15; color: #000; padding: 15px; text-align: center; 
            border-radius: 10px; font-weight: 900; font-size: 1.6rem; border: 4px solid #000;
        }
        .time-display { font-size: 1.2rem; text-align: center; font-weight: bold; color: #facc15; }

        /* è¡Œå‹•ãƒœã‚¿ãƒ³ */
        .actions button { 
            width: 100%; padding: 12px; margin-bottom: 8px; background: #334155; color: white; 
            border: 2px solid #475569; border-radius: 8px; cursor: pointer; text-align: left; font-size: 0.95rem;
        }
        .actions button:hover:not(:disabled) { background: #475569; border-color: #fbbf24; }
        .actions button:disabled { opacity: 0.2; }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ä¸ç¥¥äº‹ãƒ†ãƒ­ãƒƒãƒ— */
        .news-box { 
            background: #000; padding: 15px; border-radius: 10px; flex-grow: 1; 
            border: 2px solid #3b82f6; overflow-y: auto; font-family: monospace; font-size: 0.9rem; color: #10b981;
        }
        .breaking { color: #ff0000; font-weight: bold; animation: blink 0.8s infinite; display: block; margin-bottom: 5px; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }

        /* è­°å¸­ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
        .seat-bar-container { height: 15vh; background: #020617; padding: 10px 50px; border-top: 2px solid #334155; }
        .seat-bar { height: 50px; background: #1e293b; display: flex; position: relative; border-radius: 25px; overflow: hidden; border: 3px solid #fff; }
        .bar { transition: width 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28); height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.4rem; }
        .bar.you { background: var(--you); color: #000; }
        .bar.ai { background: var(--ai); color: #fff; }
        .majority-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: yellow; z-index: 20; }
    </style>
</head>
<body>

<div class="container">
    <div class="map-area">
        <div id="japan-map" class="japan-map"></div>
    </div>

    <div class="side">
        <div id="timeInfo" class="time-display">1æ—¥ç›®ï¼šæœ</div>
        <div class="turn-display" id="turnIndicator">ã‚ãªãŸã®ç•ªã§ã™</div>
        
        <div class="actions" id="actionPanel">
            <button onclick="setMode('speech')">ğŸ¤ è¡—é ­æ¼”èª¬ (é¸ã‚“ã çœŒã‚’ç¢ºå®Ÿç²å¾—)</button>
            <button onclick="doSNS()">ğŸ“± SNSæ´»å‹• (éƒ½å¸‚éƒ¨1çœŒã‚’ãƒ©ãƒ³ãƒ€ãƒ ç²å¾—)</button>
            <button onclick="doHome()">ğŸ  æˆ¸åˆ¥è¨ªå• (åœ°æ–¹1çœŒã‚’ç¢ºå®Ÿç²å¾—)</button>
            <button onclick="doTV()">ğŸ“º ãƒ†ãƒ¬ãƒ“å‡ºæ¼” (å…¨å›½ã®ã©ã“ã‹ã‚’ç²å¾—)</button>
            <button onclick="doFlyer()">ğŸ“„ ãƒ“ãƒ©é…å¸ƒ (å·¥æ¥­åœ°åŸŸ1çœŒã‚’ç²å¾—)</button>
        </div>

        <div class="news-box" id="newsFeed">
            <div>> é¸æŒ™æˆ¦ãŒã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ãŸï¼å…¨465è­°å¸­ã‚’å¥ªã„åˆã£ã¦ãã ã•ã„ã€‚</div>
        </div>
    </div>
</div>

<div class="seat-bar-container">
    <div style="display:flex; justify-content:space-between; margin:0 20px 5px; font-weight:bold;">
        <span style="color:var(--you)">ã‚ãªãŸå…š</span>
        <span>éåŠæ•°: 233</span>
        <span style="color:var(--ai)">AIé‡å…šé€£åˆ</span>
    </div>
    <div class="seat-bar">
        <div id="barYou" class="bar you" style="width: 0%">0</div>
        <div id="barNeutral" class="bar neutral" style="flex-grow: 1;">465</div>
        <div id="barAI" class="bar ai" style="width: 0%">0</div>
        <div class="majority-line"></div>
    </div>
</div>

<script>
// é‡ãªã‚‰ãªã„åº§æ¨™ãƒ‡ãƒ¼ã‚¿ï¼ˆåºƒç¯„å›²ã«åˆ†æ•£ï¼‰
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 700, y: 20, s: 17, t: "rural" }, "é’æ£®": { x: 700, y: 130, s: 6, t: "rural" },
    "å²©æ‰‹": { x: 800, y: 180, s: 6, t: "rural" }, "ç§‹ç”°": { x: 600, y: 180, s: 5, t: "rural" },
    "å±±å½¢": { x: 620, y: 260, s: 6, t: "rural" }, "å®®åŸ": { x: 780, y: 260, s: 10, t: "rural" },
    "ç¦å³¶": { x: 700, y: 340, s: 9, t: "rural" }, "æ–°æ½Ÿ": { x: 500, y: 230, s: 10, t: "rural" },
    "å¯Œå±±": { x: 400, y: 230, s: 6, t: "rural" }, "çŸ³å·": { x: 310, y: 230, s: 6, t: "rural" },
    "ç¦äº•": { x: 280, y: 310, s: 4, t: "rural" }, "é•·é‡": { x: 480, y: 340, s: 10, t: "rural" },
    "ç¾¤é¦¬": { x: 580, y: 380, s: 10, t: "rural" }, "æ ƒæœ¨": { x: 680, y: 420, s: 10, t: "rural" },
    "èŒ¨åŸ": { x: 780, y: 460, s: 13, t: "rural" }, "åŸ¼ç‰": { x: 600, y: 480, s: 28, t: "urban" },
    "æ±äº¬": { x: 680, y: 550, s: 30, t: "urban" }, "åƒè‘‰": { x: 780, y: 560, s: 22, t: "urban" },
    "ç¥å¥ˆå·": { x: 550, y: 600, s: 26, t: "urban" }, "å±±æ¢¨": { x: 480, y: 450, s: 4, t: "rural" },
    "é™å²¡": { x: 450, y: 550, s: 16, t: "urban" }, "æ„›çŸ¥": { x: 380, y: 500, s: 15, t: "industry" },
    "å²é˜œ": { x: 380, y: 380, s: 10, t: "rural" }, "æ»‹è³€": { x: 300, y: 400, s: 4, t: "rural" },
    "ä¸‰é‡": { x: 330, y: 600, s: 8, t: "rural" }, "å¥ˆè‰¯": { x: 250, y: 550, s: 6, t: "rural" },
    "å’Œæ­Œå±±": { x: 230, y: 650, s: 5, t: "rural" }, "äº¬éƒ½": { x: 250, y: 420, s: 12, t: "urban" },
    "å¤§é˜ª": { x: 180, y: 500, s: 19, t: "urban" }, "å…µåº«": { x: 150, y: 400, s: 12, t: "urban" },
    "é³¥å–": { x: 100, y: 300, s: 4, t: "rural" }, "å³¶æ ¹": { x: 10, y: 300, s: 4, t: "rural" },
    "å²¡å±±": { x: 100, y: 420, s: 10, t: "rural" }, "åºƒå³¶": { x: 20, y: 420, s: 12, t: "industry" },
    "å±±å£": { x: 10, y: 520, s: 8, t: "rural" }, "å¾³å³¶": { x: 150, y: 600, s: 6, t: "rural" },
    "é¦™å·": { x: 80, y: 560, s: 6, t: "rural" }, "æ„›åª›": { x: 10, y: 620, s: 8, t: "rural" },
    "é«˜çŸ¥": { x: 80, y: 680, s: 4, t: "rural" }, "ç¦å²¡": { x: 100, y: 150, s: 11, t: "urban" },
    "ä½è³€": { x: 10, y: 150, s: 4, t: "rural" }, "é•·å´": { x: 10, y: 220, s: 8, t: "rural" },
    "ç†Šæœ¬": { x: 100, y: 250, s: 8, t: "rural" }, "å¤§åˆ†": { x: 200, y: 200, s: 6, t: "rural" },
    "å®®å´": { x: 200, y: 100, s: 6, t: "rural" }, "é¹¿å…å³¶": { x: 100, y: 50, s: 9, t: "rural" },
    "æ²–ç¸„": { x: 10, y: 50, s: 4, t: "rural" }
};

let day = 1;
let turnStep = 0; // æœ, æ˜¼, å¤œ
let isPlayerTurn = true;
let actionsRemaining = 45;
const status = {};
let currentMode = null;

function init() {
    const map = document.getElementById("japan-map");
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.innerHTML = `<b>${p}</b><span>(${PREF_DATA[p].s})</span>`;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => handlePrefClick(p);
        map.appendChild(d);
    });
    updateUI();
}

function log(msg, important = false) {
    const box = document.getElementById("newsFeed");
    const span = document.createElement("span");
    if (important) span.className = "breaking";
    span.innerHTML = `> ${msg}<br>`;
    box.prepend(span);
}

function setMode(m) {
    if(!isPlayerTurn) return;
    currentMode = m;
    log(`${m === 'speech' ? 'æ¼”èª¬ã™ã‚‹çœŒã‚’é¸ã‚“ã§ãã ã•ã„' : 'æº–å‚™ä¸­...'}`);
}

function handlePrefClick(p) {
    if (!isPlayerTurn) return;
    if (currentMode === "speech") {
        status[p] = "you";
        log(`${p}ã§æ¼”èª¬ã€‚æ”¯æŒã‚’ç²å¾—ã€‚`);
        endPlayerTurn();
    } else if (currentMode === "home") {
        if (PREF_DATA[p].t === "rural") {
            status[p] = "you";
            log(`${p}ã®å…¨æˆ¸è¨ªå•ã«æˆåŠŸï¼`);
            endPlayerTurn();
        } else {
            alert("æˆ¸åˆ¥è¨ªå•ã¯ã€Œåœ°æ–¹ã€ã®çœŒã®ã¿é¸ã¹ã¾ã™ã€‚");
        }
    }
}

function doSNS() {
    if (!isPlayerTurn) return;
    const targets = Object.keys(status).filter(p => PREF_DATA[p].t === "urban" && status[p] !== "you");
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`SNSæˆ¦ç•¥ãŒæˆåŠŸï¼${p}ã‚’ç²å¾—ã€‚`);
    } else {
        log("SNSã®åŠ¹æœã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
    }
    endPlayerTurn();
}

function doHome() {
    if (!isPlayerTurn) return;
    currentMode = "home";
    log("è¨ªå•ã™ã‚‹åœ°æ–¹ã®çœŒï¼ˆ rural ï¼‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
}

function doTV() {
    if (!isPlayerTurn) return;
    const targets = Object.keys(status).filter(p => status[p] === "neutral");
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ã§${p}ã®æ”¯æŒãŒæ€¥å¢—ï¼`);
    }
    endPlayerTurn();
}

function doFlyer() {
    if (!isPlayerTurn) return;
    const targets = Object.keys(status).filter(p => PREF_DATA[p].t === "industry" && status[p] !== "you");
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`ãƒ“ãƒ©é…å¸ƒã§${p}ã®å·¥å ´è¡—ã‚’åˆ¶åœ§ï¼`);
    }
    endPlayerTurn();
}

function endPlayerTurn() {
    isPlayerTurn = false;
    currentMode = null;
    actionsRemaining--;
    updateUI();
    
    document.getElementById("turnIndicator").textContent = "ç›¸æ‰‹ã®ç•ªã§ã™...";
    document.getElementById("turnIndicator").style.background = "#ff4500";
    document.getElementById("turnIndicator").style.color = "#fff";

    setTimeout(aiTurn, 1000); // 1ç§’å¾…ã£ã¦ç›¸æ‰‹ãŒè¡Œå‹•
}

function aiTurn() {
    const targets = Object.keys(status).filter(p => status[p] !== "ai");
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "ai";
        log(`ç›¸æ‰‹å€™è£œãŒ${p}ã§æ¼”èª¬ã€‚æ”¯æŒã‚’å¥ªã‚ã‚Œã¾ã—ãŸï¼`);
    }

    turnStep++;
    if (turnStep > 2) {
        turnStep = 0;
        day++;
    }

    // 3æ—¥ã”ã¨ã«å¿…ãšä¸ç¥¥äº‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒç™ºç”Ÿ
    if (day % 3 === 0 && turnStep === 0) {
        triggerEvent();
    }

    if (actionsRemaining <= 0) {
        finish();
    } else {
        isPlayerTurn = true;
        document.getElementById("turnIndicator").textContent = "ã‚ãªãŸã®ç•ªã§ã™";
        document.getElementById("turnIndicator").style.background = "#facc15";
        document.getElementById("turnIndicator").style.color = "#000";
        updateUI();
    }
}

function triggerEvent() {
    const isYou = Math.random() > 0.5;
    const targets = Object.keys(status).filter(p => status[p] === (isYou ? "you" : "ai"));
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = isYou ? "ai" : "you";
        log(`ã€é€Ÿå ±ã€‘${isYou ? 'ã‚ãªãŸ' : 'ç›¸æ‰‹'}ã®å…šã«ä¸ç¥¥äº‹ï¼${p}ã®æ”¯æŒãŒé›¢åï¼`, true);
    }
}

function calculate(side) {
    return Object.keys(status).reduce((total, p) => status[p] === side ? total + PREF_DATA[p].s : total, 0);
}

function updateUI() {
    const you = calculate("you");
    const ai = calculate("ai");
    const neu = 465 - you - ai;
    const stepNames = ["æœ", "æ˜¼", "å¤œ"];

    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barYou").textContent = you;
    document.getElementById("barAI").style.width = (ai / 465 * 100) + "%";
    document.getElementById("barAI").textContent = ai;
    
    document.getElementById("timeInfo").textContent = `${day}æ—¥ç›®ï¼š${stepNames[turnStep]} (æ®‹ã‚Š${actionsRemaining}å›)`;
    
    Object.keys(status).forEach(p => {
        document.getElementById(`pref-${p}`).className = `pref ${status[p]}`;
    });

    const btns = document.getElementById("actionPanel").getElementsByTagName("button");
    for(let b of btns) b.disabled = !isPlayerTurn;
}

function finish() {
    const you = calculate("you");
    alert(`é¸æŒ™çµ‚äº†ï¼ã‚ãªãŸã®ç²å¾—è­°å¸­ã¯ ${you} ã§ã—ãŸã€‚`);
    location.reload();
}

window.onload = init;
</script>
</body>
</html>
