<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡†é™¢é¸ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼2026ï¼šæ”¿æ¨©å¥ªå–</title>
    <style>
        :root { --you: #00ff41; --ai: #ff0033; --neu: #334155; }
        body { margin: 0; background: #020617; color: #f8fafc; font-family: 'Hiragino Sans', 'Meiryo', sans-serif; overflow: hidden; }
        
        /* å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .header { height: 60px; background: #1e293b; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: 3px solid #facc15; }
        .container { display: flex; height: calc(100vh - 160px); }
        
        /* åœ°å›³ã‚¨ãƒªã‚¢ */
        .map-area { flex: 2.5; position: relative; background: #0f172a; overflow: auto; padding: 50px; }
        .japan-map { position: relative; width: 1100px; height: 900px; border: 1px solid #1e293b; }

        /* éƒ½é“åºœçœŒãƒ‘ãƒãƒ« */
        .pref { 
            position: absolute; width: 90px; height: 55px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-radius: 10px; cursor: pointer; transition: 0.3s; font-weight: bold; border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 4px 4px 0px #000;
        }
        .pref b { font-size: 15px; }
        .pref span { font-size: 12px; }
        .pref.neutral { background: var(--neu); color: #94a3b8; }
        .pref.you { background: var(--you); color: #000; box-shadow: 0 0 25px var(--you); border-color: #fff; }
        .pref.ai { background: var(--ai); color: #fff; box-shadow: 0 0 25px var(--ai); border-color: #fff; }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .side { flex: 1; background: #111827; padding: 20px; display: flex; flex-direction: column; gap: 15px; border-left: 2px solid #334155; }
        .turn-box { background: #facc15; color: #000; padding: 15px; text-align: center; border-radius: 10px; font-weight: 900; font-size: 1.5rem; }
        
        /* ãƒœã‚¿ãƒ³5ç¨® */
        .actions h3 { font-size: 0.9rem; margin-bottom: 10px; color: #facc15; }
        .actions button { 
            width: 100%; padding: 12px; margin-bottom: 8px; color: white; border-radius: 8px; cursor: pointer; text-align: left; font-size: 0.9rem; font-weight: bold; border: none; transition: 0.2s;
        }
        .btn-speech { background: #16a34a; } /* ç·‘ */
        .btn-sns { background: #2563eb; }    /* é’ */
        .btn-home { background: #9333ea; }   /* ç´« */
        .btn-tv { background: #ea580c; }     /* æ©™ */
        .btn-flyer { background: #475569; }  /* ç° */
        .actions button:hover:not(:disabled) { transform: translateX(5px); filter: brightness(1.2); }
        .actions button:disabled { opacity: 0.2; cursor: not-allowed; }

        /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ä¸ç¥¥äº‹ãƒ†ãƒ­ãƒƒãƒ— */
        .news-box { 
            background: #000; padding: 15px; border-radius: 10px; flex-grow: 1; 
            border: 2px solid #ef4444; overflow-y: auto; font-family: monospace; color: #10b981; font-size: 0.9rem;
        }
        .breaking { color: #ff0000; font-weight: bold; animation: blink 0.6s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }

        /* è­°å¸­ãƒãƒ¼ */
        .seat-area { height: 100px; background: #020617; padding: 10px 50px; border-top: 4px solid #334155; }
        .seat-bar { height: 40px; background: #1e293b; display: flex; position: relative; border-radius: 20px; overflow: hidden; border: 2px solid #fff; }
        .bar { transition: width 0.5s ease; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
        .bar.you { background: var(--you); color: #000; }
        .bar.ai { background: var(--ai); color: #fff; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="font-size: 1.2rem;">è¡†è­°é™¢è­°å“¡ç·é¸æŒ™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <div id="dateDisplay" style="font-size: 1.2rem; font-weight: bold;">1æ—¥ç›®ï¼šæœ (æ®‹ã‚Š 45æ‰‹)</div>
</div>

<div class="container">
    <div class="map-area">
        <div id="japan-map" class="japan-map"></div>
    </div>

    <div class="side">
        <div class="turn-box" id="turnIndicator">ã‚ãªãŸã®ç•ª</div>
        
        <div class="actions" id="actionPanel">
            <h3>ã‚³ãƒãƒ³ãƒ‰é¸æŠï¼ˆã„ãšã‚Œã‹ã‚’å®Ÿè¡Œï¼‰</h3>
            <button class="btn-speech" onclick="setMode('speech')">ğŸ¤ è¡—é ­æ¼”èª¬ (åœ°å›³ã‹ã‚‰çœŒã‚’é¸æŠ)</button>
            <button class="btn-sns" onclick="doSNS()">ğŸ“± SNSæˆ¦ç•¥ (éƒ½å¸‚éƒ¨ã‚’1ã¤å¥ªå–)</button>
            <button class="btn-home" onclick="setMode('home')">ğŸ  æˆ¸åˆ¥è¨ªå• (åœ°æ–¹ã®çœŒã‚’é¸æŠ)</button>
            <button class="btn-tv" onclick="doTV()">ğŸ“º ãƒ†ãƒ¬ãƒ“å‡ºæ¼” (å…¨å›½ã‹ã‚‰1ã¤å¥ªå–)</button>
            <button class="btn-flyer" onclick="doFlyer()">ğŸ“„ æ”¿ç­–ãƒ“ãƒ© (ä¸­ç«‹çœŒã‚’1ã¤å¥ªå–)</button>
        </div>

        <div class="news-box" id="newsFeed">
            <div>> é¸æŒ™æˆ¦ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚</div>
        </div>
    </div>
</div>

<div class="seat-area">
    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
        <span style="color:var(--you)">ã‚ãªãŸå…š</span>
        <span>éåŠæ•°: 233</span>
        <span style="color:var(--ai)">ç›¸æ‰‹å…šé€£åˆ</span>
    </div>
    <div class="seat-bar">
        <div id="barYou" class="bar you" style="width: 0%">0</div>
        <div id="barAI" class="bar ai" style="width: 0%">0</div>
        <div style="position:absolute; left:50%; top:0; bottom:0; width:4px; background:yellow; z-index:10;"></div>
    </div>
</div>

<script>
const PREF_DATA = {
    "åŒ—æµ·é“": { x: 800, y: 20, s: 17, t: "rural" }, "é’æ£®": { x: 800, y: 130, s: 6, t: "rural" },
    "ç§‹ç”°": { x: 700, y: 160, s: 5, t: "rural" }, "å²©æ‰‹": { x: 900, y: 180, s: 6, t: "rural" },
    "å±±å½¢": { x: 720, y: 260, s: 6, t: "rural" }, "å®®åŸ": { x: 880, y: 280, s: 10, t: "rural" },
    "ç¦å³¶": { x: 800, y: 360, s: 9, t: "rural" }, "æ–°æ½Ÿ": { x: 600, y: 200, s: 10, t: "rural" },
    "å¯Œå±±": { x: 500, y: 200, s: 6, t: "rural" }, "çŸ³å·": { x: 400, y: 180, s: 6, t: "rural" },
    "ç¦äº•": { x: 320, y: 250, s: 4, t: "rural" }, "é•·é‡": { x: 550, y: 320, s: 10, t: "rural" },
    "ç¾¤é¦¬": { x: 660, y: 350, s: 10, t: "rural" }, "æ ƒæœ¨": { x: 760, y: 440, s: 10, t: "rural" },
    "èŒ¨åŸ": { x: 870, y: 480, s: 13, t: "rural" }, "åŸ¼ç‰": { x: 650, y: 460, s: 28, t: "urban" },
    "æ±äº¬": { x: 700, y: 580, s: 30, t: "urban" }, "åƒè‘‰": { x: 820, y: 600, s: 22, t: "urban" },
    "ç¥å¥ˆå·": { x: 580, y: 620, s: 26, t: "urban" }, "å±±æ¢¨": { x: 500, y: 430, s: 4, t: "rural" },
    "é™å²¡": { x: 480, y: 550, s: 16, t: "urban" }, "æ„›çŸ¥": { x: 380, y: 480, s: 15, t: "urban" },
    "å²é˜œ": { x: 400, y: 360, s: 10, t: "rural" }, "æ»‹è³€": { x: 300, y: 350, s: 4, t: "rural" },
    "äº¬éƒ½": { x: 250, y: 300, s: 12, t: "urban" }, "å¤§é˜ª": { x: 200, y: 450, s: 19, t: "urban" },
    "å…µåº«": { x: 150, y: 320, s: 12, t: "urban" }, "å¥ˆè‰¯": { x: 300, y: 550, s: 6, t: "rural" },
    "å’Œæ­Œå±±": { x: 230, y: 630, s: 5, t: "rural" }, "ä¸‰é‡": { x: 360, y: 600, s: 8, t: "rural" },
    "é³¥å–": { x: 100, y: 250, s: 4, t: "rural" }, "å³¶æ ¹": { x: 0, y: 250, s: 4, t: "rural" },
    "å²¡å±±": { x: 100, y: 350, s: 10, t: "rural" }, "åºƒå³¶": { x: 10, y: 350, s: 12, t: "rural" },
    "å±±å£": { x: 10, y: 450, s: 8, t: "rural" }, "å¾³å³¶": { x: 150, y: 550, s: 6, t: "rural" },
    "é¦™å·": { x: 80, y: 520, s: 6, t: "rural" }, "æ„›åª›": { x: 10, y: 550, s: 8, t: "rural" },
    "é«˜çŸ¥": { x: 80, y: 620, s: 4, t: "rural" }, "ç¦å²¡": { x: 100, y: 150, s: 11, t: "urban" },
    "ä½è³€": { x: 10, y: 150, s: 4, t: "rural" }, "é•·å´": { x: 10, y: 220, s: 8, t: "rural" },
    "ç†Šæœ¬": { x: 100, y: 250, s: 8, t: "rural" }, "å¤§åˆ†": { x: 200, y: 200, s: 6, t: "rural" },
    "å®®å´": { x: 200, y: 100, s: 6, t: "rural" }, "é¹¿å…å³¶": { x: 100, y: 50, s: 9, t: "rural" },
    "æ²–ç¸„": { x: 10, y: 50, s: 4, t: "rural" }
};

let day = 1;
let turnStep = 0; // 0, 1, 2
let isPlayer = true;
let actions = 45;
const status = {};
let mode = null;

function init() {
    const map = document.getElementById("japan-map");
    Object.keys(PREF_DATA).forEach(p => {
        status[p] = "neutral";
        const d = document.createElement("div");
        d.className = "pref neutral";
        d.id = `pref-${p}`;
        d.innerHTML = `<b>${p}</b><span>${PREF_DATA[p].s}</span>`;
        d.style.left = PREF_DATA[p].x + "px";
        d.style.top = PREF_DATA[p].y + "px";
        d.onclick = () => handleMap(p);
        map.appendChild(d);
    });
    update();
}

function log(m, strong = false) {
    const f = document.getElementById("newsFeed");
    f.innerHTML = `<div class="${strong ? 'breaking' : ''}">> ${m}</div>` + f.innerHTML;
}

function setMode(m) {
    if (!isPlayer) return;
    mode = m;
    log(m === 'speech' ? "åœ°å›³ã‹ã‚‰æ¼”èª¬ã™ã‚‹çœŒã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚" : "åœ°å›³ã‹ã‚‰è¨ªå•ã™ã‚‹åœ°æ–¹ã®çœŒã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚");
}

function handleMap(p) {
    if (!isPlayer || !mode) return;
    if (mode === 'home' && PREF_DATA[p].t !== 'rural') {
        alert("æˆ¸åˆ¥è¨ªå•ã¯åœ°æ–¹(rural)ã®ã¿æœ‰åŠ¹ã§ã™ï¼");
        return;
    }
    status[p] = "you";
    log(`${p}ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
    endTurn();
}

function doSNS() {
    if (!isPlayer) return;
    const urbans = Object.keys(status).filter(p => PREF_DATA[p].t === 'urban' && status[p] !== 'you');
    if (urbans.length > 0) {
        const p = urbans[Math.floor(Math.random() * urbans.length)];
        status[p] = "you";
        log(`SNSæˆ¦ç•¥ï¼ ${p}ã®è‹¥è€…å±¤ã«æµ¸é€ã—ã¾ã—ãŸã€‚`);
    }
    endTurn();
}

function doTV() {
    if (!isPlayer) return;
    const targets = Object.keys(status).filter(p => status[p] === 'neutral');
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`ãƒ†ãƒ¬ãƒ“å‡ºæ¼”ï¼ ${p}ã®ç„¡å…šæ´¾å±¤ãŒå‹•ãã¾ã—ãŸã€‚`);
    }
    endTurn();
}

function doFlyer() {
    if (!isPlayer) return;
    const targets = Object.keys(status).filter(p => status[p] === 'neutral');
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "you";
        log(`ãƒ“ãƒ©é…å¸ƒå®Œäº†ã€‚${p}ã§æ”¯æŒã‚’åºƒã’ã¾ã—ãŸã€‚`);
    }
    endTurn();
}

function endTurn() {
    mode = null;
    isPlayer = false;
    actions--;
    update();
    document.getElementById("turnIndicator").textContent = "ç›¸æ‰‹ã®ç•ª...";
    document.getElementById("turnIndicator").style.background = "#ff0033";
    document.getElementById("turnIndicator").style.color = "#fff";
    setTimeout(ai, 800);
}

function ai() {
    const targets = Object.keys(status).filter(p => status[p] !== 'ai');
    if (targets.length > 0) {
        const p = targets[Math.floor(Math.random() * targets.length)];
        status[p] = "ai";
        log(`ã€è­¦å‘Šã€‘ç›¸æ‰‹å…šãŒ ${p} ã‚’å¥ªã„è¿”ã—ã¾ã—ãŸï¼`, true);
    }
    
    turnStep++;
    if (turnStep > 2) {
        turnStep = 0;
        day++;
        if (day % 3 === 0) scandal();
    }
    
    if (actions <= 0) {
        finish();
    } else {
        isPlayer = true;
        document.getElementById("turnIndicator").textContent = "ã‚ãªãŸã®ç•ª";
        document.getElementById("turnIndicator").style.background = "#facc15";
        document.getElementById("turnIndicator").style.color = "#000";
        update();
    }
}

function scandal() {
    const myPrefs = Object.keys(status).filter(p => status[p] === 'you');
    if (myPrefs.length > 0) {
        const p = myPrefs[Math.floor(Math.random() * myPrefs.length)];
        status[p] = "ai";
        log(`ã€å¤§ä¸ç¥¥äº‹ã€‘ã‚ãªãŸã®å…šã«ã‚¹ã‚­ãƒ£ãƒ³ãƒ€ãƒ«ï¼${p}ã®è­°å¸­ã‚’å¤±ã„ã¾ã—ãŸï¼`, true);
    }
}

function update() {
    const you = Object.keys(status).reduce((a, b) => status[b] === 'you' ? a + PREF_DATA[b].s : a, 0);
    const aiSeats = Object.keys(status).reduce((a, b) => status[b] === 'ai' ? a + PREF_DATA[b].s : a, 0);
    
    document.getElementById("barYou").style.width = (you / 465 * 100) + "%";
    document.getElementById("barYou").textContent = you;
    document.getElementById("barAI").style.width = (aiSeats / 465 * 100) + "%";
    document.getElementById("barAI").textContent = aiSeats;
    
    const times = ["æœ", "æ˜¼", "å¤œ"];
    document.getElementById("dateDisplay").textContent = `${day}æ—¥ç›®ï¼š${times[turnStep]} (æ®‹ã‚Š ${actions}æ‰‹)`;
    
    Object.keys(status).forEach(p => {
        document.getElementById(`pref-${p}`).className = `pref ${status[p]}`;
    });

    const btns = document.querySelectorAll(".actions button");
    btns.forEach(b => b.disabled = !isPlayer);
}

function finish() {
    const you = Object.keys(status).reduce((a, b) => status[b] === 'you' ? a + PREF_DATA[b].s : a, 0);
    if (you >= 233) {
        alert("ğŸ‰ã€ç¥ã€‘å˜ç‹¬éåŠæ•°é”æˆï¼æ”¿æ¨©äº¤ä»£æˆåŠŸã§ã™ï¼ğŸ‰");
    } else {
        alert("â— é¸æŒ™æ•—åŒ—ã€‚éåŠæ•°ã«å±Šãã¾ã›ã‚“ã§ã—ãŸã€‚ â—");
    }
    location.reload();
}

window.onload = init;
</script>
</body>
</html>
